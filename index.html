<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ±æ­¢æ·±åº¦å°è¦½</title>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 0; background-color: #f4f7f6; color: #333; padding-bottom: 100px; }
        .progress-container { position: fixed; top: 0; left: 0; width: 100%; height: 6px; background: #e0e0e0; z-index: 2000; }
        .progress-bar { height: 100%; background: linear-gradient(90deg, #ff8a00, #e52e71); width: 0%; transition: width 0.5s ease; border-radius: 0 3px 3px 0; }
        
        .beacon-banner { position: fixed; top: -120px; left: 5%; width: 90%; background: rgba(34, 34, 34, 0.95); color: white; padding: 12px 15px; border-radius: 50px; box-shadow: 0 8px 20px rgba(0,0,0,0.3); z-index: 5000; display: flex; align-items: center; gap: 12px; transition: top 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275); cursor: pointer; box-sizing: border-box; }
        .beacon-banner.show { top: 20px; } 
        .beacon-icon { width: 36px; height: 36px; background: #06C755; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; flex-shrink: 0; }
        .beacon-text { flex: 1; font-size: 13px; line-height: 1.3; }
        .beacon-title { font-weight: bold; color: #fff; font-size: 14px; }
        .beacon-sub { color: #ccc; font-size: 11px; }

        .hero-container { position: relative; width: 100%; height: 35vh; overflow: hidden; }
        .hero-img { width: 100%; height: 100%; object-fit: cover; }
        
        .content-card { position: relative; background: white; border-radius: 24px 24px 0 0; margin-top: -25px; padding: 25px; box-shadow: 0 -5px 20px rgba(0,0,0,0.05); min-height: 60vh; }
        
        .title-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        h1 { margin: 0; font-size: 24px; font-weight: 800; color: #2c3e50; }
        .wish-btn { font-size: 22px; color: #ccc; cursor: pointer; transition: transform 0.2s; padding: 5px; }
        .wish-btn.active { color: #ff4757; transform: scale(1.1); }

        .sub-tag { display: inline-block; font-size: 12px; color: #fff; background: #2c3e50; padding: 4px 10px; border-radius: 4px; margin-bottom: 10px; font-weight: bold; }
        .route-info { font-size: 13px; color: #666; margin-bottom: 15px; border-left: 3px solid #ff8a00; padding-left: 8px; line-height: 1.4; }
        .spot-number { font-size: 12px; color: #888; margin-bottom: 5px; }

        .desc-box { margin-bottom: 25px; border-bottom: 1px solid #eee; padding-bottom: 15px; }
        .desc-text { font-size: 15px; line-height: 1.8; color: #555; }
        .desc-text.expandable { max-height: 8.0em; overflow: hidden; transition: max-height 0.4s ease; }
        .desc-text.expanded { max-height: none; overflow: visible; } 
        
        .desc-actions { display: flex; justify-content: space-between; align-items: center; margin-top: 12px; }
        .read-more-btn { color: #007bff; font-weight: bold; font-size: 14px; cursor: pointer; text-decoration: underline; }
        
        .quiz-trigger-btn { background: #ff9f43; color: white; padding: 6px 14px; border-radius: 20px; font-size: 13px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

        .transport-grid { display: flex; gap: 10px; margin-bottom: 20px; }
        .t-btn { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 4px; padding: 10px; border-radius: 12px; text-decoration: none; color: white; font-weight: bold; font-size: 13px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: transform 0.1s; text-align: center; }
        .t-btn:active { transform: scale(0.96); }
        .t-btn i { font-style: normal; font-size: 18px; display: block; margin-bottom: 2px;}
        .bg-ubike { background: linear-gradient(135deg, #fce38a 0%, #f38181 100%); color: #555; }
        .bg-bus   { background: #3498db; }
        .bg-nav   { background: linear-gradient(135deg, #667eea, #764ba2); }
        .bg-parking { background: #546de5; } 
        .bus-label { font-size: 11px; opacity: 0.9; line-height: 1.2; }

        .game-section { background: #fff8e1; border: 2px dashed #ffc107; border-radius: 16px; padding: 20px; text-align: center; margin-bottom: 15px; }
        .game-title { font-weight: bold; color: #d35400; margin-bottom: 15px; font-size: 16px; }
        .task-grid { display: flex; justify-content: center; gap: 10px; margin-bottom: 10px; }
        .stamp-box { display: flex; flex-direction: column; align-items: center; gap: 5px; width: 55px; }
        
        .stamp { width: 40px; height: 40px; border-radius: 50%; background: #e0e0e0; color: #777; display: flex; align-items: center; justify-content: center; font-size: 18px; font-weight: bold; border: 2px solid #ddd; transition: all 0.3s; }
        .stamp.active { background: #ff512f; color: white; border-color: #ff512f; transform: scale(1.1); box-shadow: 0 3px 8px rgba(255, 81, 47, 0.3); }
        .stamp-label { font-size: 10px; color: #888; margin-top: 4px; font-weight: bold;}

        .share-text-link { text-align: center; margin: 15px 0; font-size: 15px; font-weight: bold; color: #555; cursor: pointer; text-decoration: underline; display: block; }

        #survey-box { display: none; margin-top: 25px; padding-top: 20px; border-top: 1px solid #eee; }
        .survey-btn { display: block; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-align: center; padding: 16px; border-radius: 12px; text-decoration: none; font-weight: bold; }

        #memorial-box { display: none; margin-top: 25px; text-align: center; background: #fafafa; padding: 20px; border-radius: 12px; }
        .memorial-title { font-size: 16px; font-weight: 800; color: #2c3e50; margin-bottom: 5px; }
        .memorial-desc { font-size: 13px; color: #666; margin-bottom: 15px; }
        
        .upload-btn-wrapper { position: relative; overflow: hidden; display: inline-block; margin-bottom: 15px; }
        .btn-upload { border: 2px dashed #007bff; color: #007bff; background-color: white; padding: 8px 16px; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 14px; }
        .upload-btn-wrapper input[type=file] { font-size: 100px; position: absolute; left: 0; top: 0; opacity: 0; cursor: pointer; }
        
        #result-canvas { display: none; }
        #final-img { width: 100%; max-width: 280px; border: 2px solid #28a745; display: none; margin: 10px auto; border-radius: 8px; }
        .download-hint { display: none; color: #28a745; font-weight: bold; font-size: 14px; margin-top: 10px; background: #e8f5e9; padding: 10px; border-radius: 8px;}
        
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 6000; display: none; align-items: flex-end; justify-content: center; }
        .share-sheet { width: 100%; max-width: 500px; background: white; border-radius: 20px 20px 0 0; padding: 25px 25px 35px 25px; box-sizing: border-box; }
        .share-title { font-size: 16px; font-weight: bold; color: #333; margin-bottom: 25px; text-align: center; }
        .share-grid { display: flex; justify-content: space-around; gap: 10px; }
        .share-item { display: flex; flex-direction: column; align-items: center; gap: 10px; cursor: pointer; color: #555; font-size: 12px; width: 70px; }
        .share-icon-box { width: 52px; height: 52px; border-radius: 14px; display: flex; align-items: center; justify-content: center; color: white; }
        .share-icon-box svg { width: 30px; height: 30px; fill: currentColor; }
        
        .quiz-box { background: white; width: 85%; max-width: 320px; padding: 20px; border-radius: 16px; text-align: center; align-self: center; }
        .quiz-question { font-size: 16px; font-weight: bold; margin-bottom: 20px; color: #333; line-height: 1.5; }
        .quiz-options { display: flex; flex-direction: column; gap: 10px; }
        .quiz-btn { padding: 12px; border: 1px solid #ddd; background: #f8f9fa; border-radius: 8px; font-size: 14px; cursor: pointer; }
        .close-modal { margin-top: 15px; color: #999; font-size: 12px; text-decoration: underline; cursor: pointer; }

        .sticky-footer { position: fixed; bottom: 0; left: 0; width: 100%; background: white; padding: 10px 15px; box-sizing: border-box; display: flex; gap: 10px; box-shadow: 0 -4px 20px rgba(0,0,0,0.08); z-index: 1000; padding-bottom: max(10px, env(safe-area-inset-bottom)); }
        .footer-btn { flex: 1; padding: 12px; border-radius: 10px; text-align: center; text-decoration: none; font-weight: bold; font-size: 15px; display: flex; align-items: center; justify-content: center; gap: 6px; }
        .btn-map { background: #f1f3f5; color: #495057; }
        .btn-food { background: #ff6b6b; color: white; }
        .btn-nav-main { background: linear-gradient(135deg, #ff6b6b, #ffa502); color: white; }

        .reset-link { margin-top: 30px; text-align: center; font-size: 12px; color: #ccc; text-decoration: underline; cursor: pointer; }
        #loading { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; display: flex; align-items: center; justify-content: center; z-index: 3000; color: #888; }

        /* ===== æ´»å‹•é é¢å°ˆç”¨æ¨£å¼ ===== */
        .event-badge { display: inline-block; background: #ff6b6b; color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; }
        .event-date { font-size: 13px; color: #888; margin: 10px 0; }
        .tags-container { display: flex; flex-wrap: wrap; gap: 8px; margin: 15px 0; }
        .tag { background: #fff0f0; color: #ff6b6b; padding: 6px 14px; border-radius: 20px; font-size: 13px; font-weight: 500; }
        .gallery-item { margin-bottom: 20px; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .gallery-img { width: 100%; height: 180px; object-fit: cover; }
        .gallery-caption { padding: 12px; background: #fafafa; font-size: 14px; color: #666; line-height: 1.6; }
        .gallery-caption strong { color: #333; }
        .notice-box { background: #fff8e1; border-left: 4px solid #ffc107; padding: 15px; border-radius: 0 12px 12px 0; margin: 20px 0; }
        .notice-box h4 { margin: 0 0 10px; color: #f57c00; font-size: 14px; }
        .notice-box ul { margin: 0; padding-left: 20px; font-size: 13px; color: #666; line-height: 1.8; }
        .section-title { font-size: 16px; font-weight: 800; color: #2c3e50; margin: 20px 0 15px; display: flex; align-items: center; gap: 8px; }
        .section-title::before { content: ""; width: 4px; height: 18px; background: linear-gradient(180deg, #ff6b6b, #ffa502); border-radius: 2px; }
    </style>
</head>
<body>

    <div id="loading"><div>â³ è¼‰å…¥ä¸­...</div></div>
    <div class="progress-container"><div id="progress-bar" class="progress-bar"></div></div>

    <div id="beacon-banner" class="beacon-banner" onclick="handleBeaconClick()">
        <div class="beacon-icon">ğŸ“¡</div>
        <div class="beacon-text">
            <div class="beacon-title">åµæ¸¬åˆ° LINE Beacon è¨Šè™Ÿ</div>
            <div class="beacon-sub">é™„è¿‘æœ‰éš±è—æ™¯é»ï¼é»æ“Šæ‰“å¡</div>
        </div>
    </div>

    <div id="main-content" style="display: none;">
        <div class="hero-container"><img id="spot-img" class="hero-img" src="" alt="åœ–ç‰‡"></div>
        <div class="content-card">
            <span id="route-tag" class="sub-tag">æ±æ­¢å°è¦½</span>
            <div id="route-desc" class="route-info"></div>
            <div id="spot-number" class="spot-number"></div>
            
            <div class="title-row">
                <h1 id="spot-title"></h1>
                <div id="wish-btn" class="wish-btn" onclick="triggerWishlist()">â™¡</div>
            </div>
            
            <div class="desc-box">
                <div id="spot-desc-container" class="desc-text expandable"><span id="spot-desc"></span></div>
                <div id="desc-actions" class="desc-actions">
                    <div id="read-more-btn" class="read-more-btn" onclick="toggleDesc()">â–¼ äº†è§£æ›´å¤šæ•…äº‹</div>
                    <div id="quiz-btn" class="quiz-trigger-btn" onclick="openQuizModal()">
                        <span>ğŸ§  çŸ¥è­˜å°å­¸å ‚</span>
                    </div>
                </div>
            </div>

            <!-- æ´»å‹•å°ˆç”¨å€åŸŸ -->
            <div id="tags-container" class="tags-container" style="display:none;"></div>
            <div id="gallery-section" style="display:none;">
                <div class="section-title">æ´»å‹•èŠ±çµ®</div>
                <div id="gallery-content"></div>
            </div>
            <div id="notice-box" class="notice-box" style="display:none;">
                <h4>ğŸ“Œ åƒåŠ é ˆçŸ¥</h4>
                <ul id="notice-list"></ul>
            </div>

            <div class="transport-grid">
                <a href="https://www.google.com/maps/search/YouBike/" target="_blank" class="t-btn bg-ubike">
                    <i>ğŸš²</i> YouBike
                </a>
                <a id="bus-btn" href="#" target="_blank" class="t-btn bg-bus" onclick="collectAction('bus')">
                    <i>ğŸšŒ</i> <span id="bus-label" class="bus-label">å»ä¸‹ä¸€ç«™</span>
                </a>
                <a id="parking-btn" href="#" target="_blank" class="t-btn bg-parking">
                    <i>ğŸ…¿ï¸</i> æ‰¾åœè»Šå ´
                </a>
            </div>

            <div id="bus-schedule-link" style="text-align: center; margin-bottom: 20px;">
                <a href="https://www.xizhi.ntpc.gov.tw/home.jsp?id=1ee324bfb5e44418" target="_blank" style="font-size: 12px; color: #999; text-decoration: underline;">
                    ğŸ“„ Fç³»åˆ—ç¤¾å€å·´å£«æ™‚åˆ»è¡¨
                </a>
            </div>

            <!-- æ™¯é»å°ˆç”¨ï¼šé›†é»å€ -->
            <div id="game-section" class="game-section">
                <div class="game-title">ğŸ† æ±æ­¢é”äººæŒ‘æˆ° (é€²åº¦: <span id="progress-text">0/5</span>)</div>
                <div class="task-grid">
                    <div class="stamp-box"><div class="stamp" id="stamp-map">ğŸ—ºï¸</div><div class="stamp-label">æ‰¾è·¯</div></div>
                    <div class="stamp-box"><div class="stamp" id="stamp-quiz">â“</div><div class="stamp-label">å•ç­”</div></div>
                    <div class="stamp-box"><div class="stamp" id="stamp-wish">â¤ï¸</div><div class="stamp-label">æƒ³å»</div></div>
                    <div class="stamp-box"><div class="stamp" id="stamp-beacon">ğŸ“¡</div><div class="stamp-label">å°‹å¯¶</div></div>
                    <div class="stamp-box"><div class="stamp" id="stamp-bus">ğŸšŒ</div><div class="stamp-label">äº¤é€š</div></div>
                </div>
                <div style="font-size: 12px; color:#888; margin-top:5px;">ğŸ’¡ è«‹å¾é é¢å„è™•å°‹æ‰¾äº’å‹•æ©Ÿæœƒï¼Œå®Œæˆä¸Šæ–¹æŒ‘æˆ°ï¼</div>
            </div>

            <div class="share-text-link" onclick="openShareModal()">ğŸ“¤ è¦ºå¾—ä¸éŒ¯ï¼Ÿæ‰“å¡ä¸¦åˆ†äº«çµ¦å¥½å‹</div>

            <div id="survey-box">
                <a href="#" target="_blank" class="survey-btn">ğŸ“ ä»»å‹™é”æˆï¼å¡«å¯«å•å·é ˜å–è­‰æ›¸</a>
            </div>

            <div id="memorial-box">
                <div class="memorial-title">ğŸ é¡å¤–çå‹µï¼šå®Œè³½ç´€å¿µç…§</div>
                <p class="memorial-desc">ä¸Šå‚³è‡ªæ‹ç…§ï¼Œåˆæˆæ±æ­¢é”äººç›¸æ¡†ï¼</p>
                <div class="upload-btn-wrapper">
                    <button class="btn-upload">ğŸ“¸ é¸æ“‡ç…§ç‰‡ / é–‹å•Ÿç›¸æ©Ÿ</button>
                    <input type="file" id="upload-input" accept="image/*" onchange="handleImageUpload(event)">
                </div>
                <canvas id="result-canvas"></canvas>
                <img id="final-img" src="" alt="åˆæˆç…§ç‰‡">
                <div id="download-msg" class="download-hint">ğŸ‘† è«‹ã€Œé•·æŒ‰ä¸Šæ–¹åœ–ç‰‡ã€å„²å­˜è‡³æ‰‹æ©Ÿç›¸ç°¿</div>
            </div>

            <div id="reset-link" class="reset-link" onclick="resetProgress()">â†º é‡ç½®æ¸¬è©¦é€²åº¦</div>
        </div>
    </div>

    <div class="sticky-footer">
        <a id="map-btn" href="#" class="footer-btn btn-map" target="_blank" onclick="handleClickWithTrack('map')">ğŸ“ å¸¶æˆ‘å»</a>
        <a id="food-btn" href="#" class="footer-btn btn-food" target="_blank">ğŸ´ é™„è¿‘ç¾é£Ÿ</a>
    </div>

    <div id="share-modal" class="modal-overlay" onclick="closeModal('share-modal', event)">
        <div class="share-sheet">
            <div class="share-title">åˆ†äº« ğŸ“¢</div>
            <div class="share-grid">
                <div class="share-item" onclick="shareTo('line')"><div class="share-icon-box" style="background:#06C755;"><svg viewBox="0 0 24 24"><path d="M22 10.3c0-4.7-4.3-8.6-10-8.6-5.4 0-10 3.9-10 8.6 0 4.2 3.8 7.8 8.4 8.5.3 0 .7.2.8.5 0 0 .3 1.1.3 1.3-.1.5-.4 1.8-1.7 2.5 1.4 0 4.3-.9 6-3.1 3.5-1.5 6.2-4.8 6.2-9.7z"/></svg></div><span>LINE</span></div>
                <div class="share-item" onclick="shareTo('fb')"><div class="share-icon-box" style="background:#1877F2;"><svg viewBox="0 0 24 24"><path d="M22 12c0-5.5-4.5-10-10-10S2 6.5 2 12c0 5 3.7 9.1 8.4 9.9v-7H7.9V12h2.5V9.8c0-2.5 1.5-3.9 3.8-3.9 1.1 0 2.2.2 2.2.2v2.5h-1.3c-1.2 0-1.6.8-1.6 1.6V12h2.8l-.4 2.9h-2.4v7C18.3 21.1 22 17 22 12z"/></svg></div><span>Facebook</span></div>
                <div class="share-item" onclick="shareTo('copy')"><div class="share-icon-box" style="background:#555;"><svg viewBox="0 0 24 24"><path d="M16 1H4C2.9 1 2 1.9 2 3V17H4V3H16V1ZM19 5H8C6.9 5 6 5.9 6 7V21C6 22.1 6.9 23 8 23H19C20.1 23 21 22.1 21 21V7C21 5.9 20.1 5 19 5ZM19 21H8V7H19V21Z"/></svg></div><span>è¤‡è£½é€£çµ</span></div>
            </div>
        </div>
    </div>

    <div id="quiz-modal" class="modal-overlay">
        <div class="quiz-box">
            <div id="quiz-question" class="quiz-question">Q: å•é¡Œè¼‰å…¥ä¸­...</div>
            <div class="quiz-options">
                <button class="quiz-btn" id="quiz-opt-1" onclick="checkQuiz(1)">A. é¸é …1</button>
                <button class="quiz-btn" id="quiz-opt-2" onclick="checkQuiz(2)">B. é¸é …2</button>
                <button class="quiz-btn" id="quiz-opt-3" onclick="checkQuiz(3)">C. é¸é …3</button>
            </div>
            <div class="close-modal" onclick="closeModal('quiz-modal', event)">æ”¾æ£„æŒ‘æˆ°</div>
        </div>
    </div>

    <script>
        var MY_LIFF_ID = "2008941841-8KQq29wn"; 
        var SURVEYCAKE_URL = "https://www.surveycake.com/s/æ‚¨çš„å•å·ä»£ç¢¼"; 
        var TASKS = ['map', 'quiz', 'wish', 'beacon', 'bus'];
        var FRAME_IMG_SRC = "./frame.png"; 

        // è·¯ç·šè³‡è¨Š
        var routesInfo = {
            "R1": { title: "ä¸€èŒ¶ä¸€ç¤¦", desc: "æ¸…ä»£åŒ…ç¨®èŒ¶èˆ‡æ—¥æ²»ç…¤ç¤¦çš„é›™è»Œæ™‚å…‰", spots: ["spot1","spot2","spot3","spot4","spot5","spot6","spot7","spot8","spot9"] },
            "R2": { title: "å±±æ—ç§˜å¢ƒ", desc: "èµ°é€²å¾Œå±±ï¼Œçœºæœ›è‡ºåŒ—ç›†åœ°çš„é¼é—Šæ™¯ç·»", spots: ["spot1","spot10","spot11","spot12","spot13","spot14"] },
            "R3": { title: "ç¶²ç¾æ‰“å¡", desc: "å¾å½äº¬éƒ½åˆ°å¤¢å¹»æ¹–æ™¯", spots: ["spot15","spot16","spot17","spot18","spot19"] },
            "R4": { title: "ç™¾å¹´ä¿¡ä»°", desc: "è§£è®€æ±æ­¢çš„å¤šå±¤ä¿¡ä»°èˆ‡æ­·å²å¢“åœ’", spots: ["spot1","spot20","spot21","spot22","spot23"] }
        };

        // æ™¯é»è³‡æ–™åº«
        var spotsData = {
            "spot1": { id: 1, route: "R1", title: "æ±æ­¢ç«è»Šç«™", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/6/66/TRA_Xizhi_Station_202308.jpg/800px-TRA_Xizhi_Station_202308.jpg", desc: "æ—…ç¨‹èµ·é»ã€‚ã€Œæ±æ­¢ã€èˆŠç¨±ã€Œæ°´è¿”è…³ã€ï¼Œæ„æŒ‡åŸºéš†æ²³æ½®æ±è‡³æ­¤è€Œè¿”ã€‚ç«™å‰å»£å ´æ˜¯æ„Ÿå—åœ¨åœ°æ´»åŠ›çš„æœ€ä½³èµ·é»ã€‚", query: "æ±æ­¢ç«è»Šç«™", hasBeacon: true, quizQ: "Q: æ±æ­¢èˆŠç¨±ä»€éº¼ï¼Ÿ", quizA: 2, quizOpts: ["A. é›ç± ", "B. æ°´è¿”è…³", "C. è‰‹èˆº"] },
            "spot2": { id: 2, route: "R1", title: "æ¿Ÿå¾·å®®", img: "https://tour.ntpc.gov.tw/Content/Upload/Place/6d368051-9e7f-44e8-8a4e-1b8f5745778a.jpg", desc: "ä¿—ç¨±æ±æ­¢åª½ç¥–å»Ÿï¼Œæ˜¯é€šéˆå°‘å¥³çš„å–æ™¯åœ°ï¼Œä¹Ÿæ˜¯åœ¨åœ°é‡è¦ä¿¡ä»°ä¸­å¿ƒï¼Œè¦‹è­‰äº†è€è¡—çš„èˆˆè¡°ã€‚", query: "æ±æ­¢æ¿Ÿå¾·å®®", hasBeacon: false, quizQ: "Q: æ¿Ÿå¾·å®®æ›¾æ˜¯å“ªéƒ¨æˆ²åŠ‡çš„å–æ™¯åœ°ï¼Ÿ", quizA: 1, quizOpts: ["A. é€šéˆå°‘å¥³", "B. èŠ±ç”²ç”·å­©", "C. ä¿—å¥³é¤Šæˆè¨˜"] },
            "spot3": { id: 3, route: "R1", title: "è˜‡å®¶å¤å", img: "https://newtaipei.travel/content/images/attractions/26786/1024x768_attractions-image-j1o3r4gbu06342s3z9s-qa.jpg", desc: "ç´…ç£šæ‹±å»Šçš„ç™¾å¹´èŒ¶å•†å®…é‚¸ï¼Œè¦‹è­‰äº†æ±æ­¢èŒ¶è‘‰å¤–éŠ·çš„é»ƒé‡‘å¹´ä»£ã€‚", query: "æ±æ­¢è˜‡å®¶å¤å", hasBeacon: false, quizQ: "Q: è˜‡å®¶å¤åè¦‹è­‰äº†ä»€éº¼ç”¢æ¥­ï¼Ÿ", quizA: 2, quizOpts: ["A. ç…¤ç¤¦", "B. èŒ¶è‘‰å¤–éŠ·", "C. æ¼æ¥­"] },
            "spot4": { id: 4, route: "R1", title: "æ±æ­¢è€è¡—", img: "https://tour.ntpc.gov.tw/Content/Upload/Place/ed979927-567c-48c9-947b-1178c520857b.jpg", desc: "ä¸­æ­£è€è¡—ï¼Œæ¸…ä»£ã€Œå³°ä»”å³™åº„ã€å•†æ¥­è¡—éºè·¡ã€‚", query: "æ±æ­¢ä¸­æ­£è€è¡—", hasBeacon: false, quizQ: "Q: æ±æ­¢è€è¡—çš„æ¸…ä»£åç¨±æ˜¯ï¼Ÿ", quizA: 3, quizOpts: ["A. æ°´è¿”è…³è¡—", "B. åŸºéš†è¡—", "C. å³°ä»”å³™åº„"] },
            "spot5": { id: 5, route: "R1", title: "å»ºé †èŒ¶è¡Œ", img: "https://newtaipei.travel/content/images/attractions/41830/1024x768_attractions-image-1.jpg", desc: "å‰µç«‹æ–¼1885å¹´ï¼Œæ±æ­¢ç¾å­˜æœ€å¤è€çš„èŒ¶è¡Œã€‚", query: "æ±æ­¢å»ºé †èŒ¶è¡Œ", hasBeacon: true, quizQ: "Q: å»ºé †èŒ¶è¡Œå‰µç«‹æ–¼å“ªä¸€å¹´ï¼Ÿ", quizA: 1, quizOpts: ["A. 1885å¹´", "B. 1900å¹´", "C. 1920å¹´"] },
            "spot6": { id: 6, route: "R1", title: "èŒ„è‹³è…³éµè·¯éºè·¡", img: "https://tour.ntpc.gov.tw/Content/Upload/Place/6d368051-9e7f-44e8-8a4e-1b8f5745778a.jpg", desc: "ä¿ç•™è‘—æ¸…é ˜æ™‚æœŸè‡³æ—¥æ²»æ™‚æœŸçš„éµè·¯åŸºåº§ã€‚", query: "æ±æ­¢èŒ„è‹³è…³éµè·¯éºè·¡", hasBeacon: false, quizQ: "Q: èŒ„è‹³è…³éºè·¡ä¿ç•™äº†ä»€éº¼ï¼Ÿ", quizA: 2, quizOpts: ["A. å¤äº•", "B. éµè·¯åŸºåº§", "C. åŸç‰†"] },
            "spot7": { id: 7, route: "R1", title: "æ˜Ÿå…‰æ©‹", img: "https://newtaipei.travel/content/images/attractions/26815/1024x768_attractions-image-w4q9s3h5g06342s3z9s-qa.jpg", desc: "æ©«è·¨åŸºéš†æ²³çš„å–®æ–œå¡”æ™¯è§€æ©‹ï¼Œé€ å‹å¦‚éº¥å…‹é¢¨ã€‚", query: "æ±æ­¢æ˜Ÿå…‰æ©‹", hasBeacon: true, quizQ: "Q: æ˜Ÿå…‰æ©‹çš„é€ å‹åƒä»€éº¼ï¼Ÿ", quizA: 3, quizOpts: ["A. å‰ä»–", "B. å¸†èˆ¹", "C. éº¥å…‹é¢¨"] },
            "spot8": { id: 8, route: "R1", title: "æ±å±±ç…¤ç¤¦éºè·¡", img: "https://newtaipei.travel/content/images/attractions/26815/1024x768_attractions-image-w4q9s3h5g06342s3z9s-qa.jpg", desc: "æ±æ­¢æ›¾æ˜¯åŒ—å°ç£é‡è¦ç…¤ç¤¦ç”¢åœ°ã€‚", query: "æ±æ­¢æ±å±±ç…¤ç¤¦", hasBeacon: false, quizQ: "Q: æ±æ­¢æ›¾æ˜¯ä»€éº¼é‡è¦ç”¢åœ°ï¼Ÿ", quizA: 1, quizOpts: ["A. ç…¤ç¤¦", "B. é‡‘ç¤¦", "C. éŠ…ç¤¦"] },
            "spot9": { id: 9, route: "R1", title: "äº”å µéµè·¯éš§é“", img: "https://newtaipei.travel/content/images/attractions/26786/1024x768_attractions-image-j1o3r4gbu06342s3z9s-qa.jpg", desc: "ç©¿è¶Šæ™‚ç©ºçš„ç´…ç£šéš§é“ï¼Œç¾æ”¹å»ºç‚ºè‡ªè¡Œè»Šé“ã€‚", query: "äº”å µå°éµèˆŠéš§é“", hasBeacon: false, quizQ: "Q: äº”å µéš§é“ç¾åœ¨çš„ç”¨é€”æ˜¯ï¼Ÿ", quizA: 2, quizOpts: ["A. ç«è»Šé€šè¡Œ", "B. è‡ªè¡Œè»Šé“", "C. æ­¥é“"] },
            "spot10": { id: 10, route: "R2", title: "è–å¾·å®®", img: "https://duk.tw/QF86I6.jpg", desc: "ä½æ–¼å¤§å°–å±±è…°ï¼Œå®®å»Ÿå»ºç¯‰å®å‰ï¼Œè¦–é‡æ¥µä½³ã€‚", query: "æ±æ­¢è–å¾·å®®", hasBeacon: false, quizQ: "Q: è–å¾·å®®ä¸»è¦ä¾›å¥‰å“ªä½ç¥æ˜ï¼Ÿ", quizA: 1, quizOpts: ["A. é—œè–å¸å›", "B. åª½ç¥–", "C. åœŸåœ°å…¬"] },
            "spot11": { id: 11, route: "R2", title: "å¤§å°–å±±å¤©ç§€å®®", img: "https://duk.tw/QF86I6.jpg", desc: "æ±æ­¢æœ€è‘—åçš„è³æ™¯é»ä¹‹ä¸€ï¼Œå¯ä¿¯ç°å¤§å°åŒ—ç›†åœ°ã€‚", query: "æ±æ­¢å¤©ç§€å®®", hasBeacon: true, quizQ: "Q: å¤©ç§€å®®æœ€è‘—åçš„æ™¯è§€æ˜¯ï¼Ÿ", quizA: 3, quizOpts: ["A. ç€‘å¸ƒ", "B. å¤æ¨¹", "C. ä¿¯ç°å¤§å°åŒ—ç›†åœ°"] },
            "spot12": { id: 12, route: "R2", title: "å¤§å°–å±±ç™»å±±æ­¥é“", img: "https://duk.tw/QF86I6.jpg", desc: "çŸ³éšé‹ªè¨­å®Œå–„ï¼Œæ²¿é€”æ—è”­èŒ‚å¯†ã€‚", query: "å¤§å°–å±±ç™»å±±æ­¥é“", hasBeacon: false, quizQ: "Q: å¤§å°–å±±çš„æµ·æ‹”ç´„å¤šå°‘å…¬å°ºï¼Ÿ", quizA: 2, quizOpts: ["A. 260 å…¬å°º", "B. 460 å…¬å°º", "C. 660 å…¬å°º"] },
            "spot13": { id: 13, route: "R2", title: "ç§€å³°ç€‘å¸ƒ", img: "https://duk.tw/QF86I6.jpg", desc: "è—èº«æ–¼å³½è°·ä¹‹ä¸­çš„æ¸…å¹½ç€‘å¸ƒï¼Œå……æ»¿è² é›¢å­ã€‚", query: "æ±æ­¢ç§€å³°ç€‘å¸ƒ", hasBeacon: true, quizQ: "Q: ç§€å³°ç€‘å¸ƒä»¥ä»€éº¼èåï¼Ÿ", quizA: 2, quizOpts: ["A. æº«æ³‰", "B. è² é›¢å­", "C. è¢ç«èŸ²"] },
            "spot14": { id: 14, route: "R2", title: "å››åˆ†å°¾å±±", img: "https://duk.tw/QF86I6.jpg", desc: "æ±æ­¢çŸ¥åå°ç™¾å²³ï¼Œæ“æœ‰ä¸€ç­‰ä¸‰è§’é»ã€‚", query: "æ±æ­¢å››åˆ†å°¾å±±", hasBeacon: false, quizQ: "Q: å››åˆ†å°¾å±±æœ‰ä»€éº¼ç‰¹æ®Šæ¨™è¨˜ï¼Ÿ", quizA: 1, quizOpts: ["A. ä¸€ç­‰ä¸‰è§’é»", "B. å¤è¹Ÿç¢‘", "C. è§€æ™¯å°"] },
            "spot15": { id: 15, route: "R3", title: "æ±ç§‘ç«è»Šç«™", img: "https://duk.tw/xAZcvt.jpg", desc: "æ“æœ‰ç¨ç‰¹çš„é•·å‹æœˆå°è¨­è¨ˆã€‚", query: "æ±ç§‘ç«è»Šç«™", hasBeacon: false, quizQ: "Q: æ±ç§‘ç«™æœ‰ä»€éº¼ç‰¹åˆ¥ä¹‹è™•ï¼Ÿ", quizA: 2, quizOpts: ["A. æœ€å¤è€è»Šç«™", "B. ç‰¹é•·æœˆå°è¨­è¨ˆ", "C. æµ·æ™¯è»Šç«™"] },
            "spot16": { id: 16, route: "R3", title: "æ‹±åŒ—æ®¿", img: "https://duk.tw/xAZcvt.jpg", desc: "åŒ—å°ç£è³æ¥“å‹åœ°ï¼Œè‘—åçš„ã€Œå½¼å²¸æ©‹ã€å……æ»¿æ—¥å¼å¤å‰é¢¨æƒ…ã€‚", query: "æ±æ­¢æ‹±åŒ—æ®¿", hasBeacon: true, quizQ: "Q: æ‹±åŒ—æ®¿æœ€è‘—åçš„æ˜¯ä»€éº¼ï¼Ÿ", quizA: 2, quizOpts: ["A. æ«»èŠ±", "B. æ¥“è‘‰èˆ‡å½¼å²¸æ©‹", "C. ç€‘å¸ƒ"] },
            "spot17": { id: 17, route: "R3", title: "æ–°å±±å¤¢æ¹–", img: "https://duk.tw/xAZcvt.jpg", desc: "å¤¢å¹»èˆ¬çš„ç¢§ç¶ æ¹–æ³Šï¼Œå©šç´—æ‹æ”è–åœ°ã€‚", query: "æ–°å±±å¤¢æ¹–", hasBeacon: true, quizQ: "Q: æ–°å±±å¤¢æ¹–ä»¥ä»€éº¼èåï¼Ÿ", quizA: 1, quizOpts: ["A. å©šç´—æ‹æ”è–åœ°", "B. æº«æ³‰", "C. å¤è¹Ÿ"] },
            "spot18": { id: 18, route: "R3", title: "å¤§é‡‘å‰›å²©", img: "https://duk.tw/xAZcvt.jpg", desc: "æ–°å±±ç¨œç·šä¸Šçš„å·¨å²©ï¼Œå½¢ç‹€é…·ä¼¼é‡‘å‰›é ­éƒ¨ã€‚", query: "æ–°å±±å¤§é‡‘å‰›å²©", hasBeacon: false, quizQ: "Q: å¤§é‡‘å‰›å²©çš„åç¨±ç”±ä¾†ï¼Ÿ", quizA: 3, quizOpts: ["A. ç™¼ç¾è€…å§“å", "B. åœ°å", "C. å½¢ç‹€åƒé‡‘å‰›"] },
            "spot19": { id: 19, route: "R3", title: "æ–°å±±", img: "https://duk.tw/xAZcvt.jpg", desc: "æµ·æ‹”499å…¬å°ºï¼Œå±±é ‚å²©çŸ³è£¸éœ²ï¼Œæ¥µå…·é‡è¶£ã€‚", query: "æ±æ­¢æ–°å±±", hasBeacon: false, quizQ: "Q: æ–°å±±çš„æµ·æ‹”ç´„å¤šå°‘å…¬å°ºï¼Ÿ", quizA: 2, quizOpts: ["A. 299 å…¬å°º", "B. 499 å…¬å°º", "C. 699 å…¬å°º"] },
            "spot20": { id: 20, route: "R4", title: "ç§€å³°å±±éœä¿®ç¦ªé™¢", img: "https://duk.tw/zESfwL.jpg", desc: "å¹½éœç¦ªé™¢ï¼Œç’°å¢ƒæ¸…å¹½ï¼Œåº­åœ’é€ æ™¯å…¸é›…ã€‚", query: "æ±æ­¢éœä¿®ç¦ªé™¢", hasBeacon: false, quizQ: "Q: éœä¿®ç¦ªé™¢ä½æ–¼å“ªåº§å±±ï¼Ÿ", quizA: 1, quizOpts: ["A. ç§€å³°å±±", "B. å¤§å°–å±±", "C. å››åˆ†å°¾å±±"] },
            "spot21": { id: 21, route: "R4", title: "æœæœˆç¬™å¢“åœ’", img: "https://duk.tw/zESfwL.jpg", desc: "ä¸Šæµ·ç˜å‚³å¥‡äººç‰©æœæœˆç¬™çš„é•·çœ ä¹‹åœ°ã€‚", query: "æœæœˆç¬™å¢“åœ’", hasBeacon: true, quizQ: "Q: æœæœˆç¬™æ˜¯å“ªè£¡çš„å‚³å¥‡äººç‰©ï¼Ÿ", quizA: 3, quizOpts: ["A. å°åŒ—", "B. é¦™æ¸¯", "C. ä¸Šæµ·"] },
            "spot22": { id: 22, route: "R4", title: "ç§€å³°å±±å½Œå‹’å…§é™¢", img: "https://duk.tw/zESfwL.jpg", desc: "ä¾›å¥‰å½Œå‹’ä½›çš„èŠåš´é“å ´ï¼Œå»ºç¯‰å®å‰ã€‚", query: "æ±æ­¢å½Œå‹’å…§é™¢", hasBeacon: false, quizQ: "Q: å½Œå‹’å…§é™¢ä¸»è¦ä¾›å¥‰ï¼Ÿ", quizA: 2, quizOpts: ["A. è§€éŸ³è©è–©", "B. å½Œå‹’ä½›", "C. åœ°è—ç‹è©è–©"] },
            "spot23": { id: 23, route: "R4", title: "å¿ é †å»Ÿ", img: "https://duk.tw/zESfwL.jpg", desc: "åŸå€ç‚ºæ—¥æ²»æ™‚æœŸçš„ã€Œæ±æ­¢ç¥ç¤¾ã€ï¼Œä¿ç•™é³¥å±…ã€‚", query: "æ±æ­¢å¿ é †å»Ÿ", hasBeacon: true, quizQ: "Q: å¿ é †å»ŸåŸæœ¬æ˜¯ä»€éº¼å»ºç¯‰ï¼Ÿ", quizA: 2, quizOpts: ["A. åª½ç¥–å»Ÿ", "B. æ—¥æœ¬ç¥ç¤¾", "C. å­”å»Ÿ"] }
        };

        // æ´»å‹•è³‡æ–™åº«
        var eventsData = {
            "E01": {
                id: "E01", title: "å¤¢æƒ³ç¤¾å€å˜‰å¹´è¯", date: "2026/12/15", location: "æ±æ­¢å¤¢æƒ³ç¤¾å€", query: "æ±æ­¢å¤¢æƒ³ç¤¾å€",
                img: "https://images.unsplash.com/photo-1533174072545-7a4b6ad7a6c3?w=800",
                desc: "å…¨å°æœ€ç˜‹ç‹‚çš„è—è¡“éŠè¡Œï¼Œçµåˆæ£®å·´é¼“èˆ‡å¤§å‹èŠ±è»Šï¼Œå±•ç¾æ±æ­¢çš„ç†±æƒ…èˆ‡å‰µæ„ã€‚æ¯å¹´å¸å¼•ä¸Šè¬äººåƒèˆ‡ï¼Œæ˜¯æ±æ­¢å¹´åº¦æœ€ç››å¤§çš„ç¤¾å€æ´»å‹•ã€‚ç¾å ´é‚„æœ‰ç¾é£Ÿå¸‚é›†ã€æ‰‹ä½œæ”¤ä½ã€å…’ç«¥éŠæˆ²å€ï¼Œé©åˆå…¨å®¶å¤§å°ä¸€åŒåƒèˆ‡ï¼",
                tags: ["ğŸ­ è—è¡“éŠè¡Œ", "ğŸ¥ æ£®å·´é¼“", "ğŸª èŠ±è»ŠéŠè¡Œ", "ğŸœ ç¾é£Ÿå¸‚é›†", "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ è¦ªå­æ´»å‹•"],
                gallery: [
                    { img: "https://images.unsplash.com/photo-1514525253161-7a46d19cd819?w=600", caption: "<strong>æ£®å·´é¼“éšŠç†±æƒ…æ¼”å‡º</strong><br>ä¾†è‡ªå„åœ°çš„æ£®å·´é¼“éšŠé½Šèšæ±æ­¢ï¼Œç”¨ç†±æƒ…çš„ç¯€å¥é»ç‡ƒæ•´æ¢è¡—é“ï¼" },
                    { img: "https://images.unsplash.com/photo-1492684223066-81342ee5ff30?w=600", caption: "<strong>ç¹½ç´›èŠ±è»ŠéŠè¡Œ</strong><br>ç¤¾å€å±…æ°‘ç²¾å¿ƒæ‰“é€ çš„èŠ±è»Šï¼Œå±•ç¾ç„¡é™å‰µæ„èˆ‡åœ¨åœ°ç‰¹è‰²ã€‚" },
                    { img: "https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=600", caption: "<strong>ç¾é£Ÿå¸‚é›†é£„é¦™</strong><br>è¶…é 50 å€‹æ”¤ä½ï¼Œå¾å‚³çµ±å°åƒåˆ°ç•°åœ‹æ–™ç†æ‡‰æœ‰ç›¡æœ‰ï¼" }
                ],
                notices: ["æ´»å‹•ç•¶å¤©å‘¨é‚Šé“è·¯ç®¡åˆ¶ï¼Œå»ºè­°æ­ä¹˜å¤§çœ¾é‹è¼¸", "ç¾å ´è¨­æœ‰æµå‹•å»æ‰€åŠé†«è­·ç«™", "è«‹è‡ªå‚™ç’°ä¿é¤å…·éŸ¿æ‡‰ç’°ä¿", "å¯µç‰©è«‹ç¹«ç‰½ç¹©ä¸¦è‡ªè¡Œæ¸…ç†æ’æ³„ç‰©"]
            },
            "E02": {
                id: "E02", title: "åº·èª¥æºªæ«»èŠ±å­£", date: "2026/02/15", location: "æ±æ­¢åº·èª¥æºªç•”", query: "æ±æ­¢åº·èª¥æºª",
                img: "https://images.unsplash.com/photo-1522383225653-ed111181a951?w=800",
                desc: "æ±æ­¢äººçš„è³æ«»ç§˜å¢ƒï¼åº·èª¥æºªæ²¿å²¸ç¨®æ¤æ•¸ç™¾æ ªå±±æ«»èŠ±ï¼Œæ¯å¹´äºŒæœˆç››é–‹æ™‚ç²‰ç´…èŠ±æµ·ç¶¿å»¶æ•¸ç™¾å…¬å°ºã€‚å¤œé–“é»ç‡ˆå¾Œæ›´æ·»æµªæ¼«æ°›åœï¼Œæ˜¯æƒ…ä¾¶ç´„æœƒã€å®¶åº­å‡ºéŠçš„çµ•ä½³é¸æ“‡ã€‚",
                tags: ["ğŸŒ¸ å±±æ«»èŠ±", "ğŸŒ™ å¤œé–“é»ç‡ˆ", "ğŸ“¸ æ”å½±è–åœ°", "ğŸ’‘ æµªæ¼«ç´„æœƒ", "ğŸš¶ è¼•é¬†æ•£æ­¥"],
                gallery: [
                    { img: "https://images.unsplash.com/photo-1490750967868-88aa4486c946?w=600", caption: "<strong>ç²‰ç´…èŠ±æµ·ç››é–‹</strong><br>æ•¸ç™¾æ ªå±±æ«»èŠ±åŒæ™‚ç¶»æ”¾ï¼Œå½¢æˆå¤¢å¹»çš„ç²‰ç´…éš§é“ã€‚" },
                    { img: "https://images.unsplash.com/photo-1462275646964-a0e3571f4f9f?w=600", caption: "<strong>å¤œæ«»é»ç‡ˆæ´»å‹•</strong><br>ç‰¹åˆ¥è¦åŠƒå¤œé–“ç…§æ˜ï¼Œè®“æ‚¨é«”é©—ä¸åŒæ–¼ç™½å¤©çš„æµªæ¼«æ°›åœã€‚" },
                    { img: "https://images.unsplash.com/photo-1545048702-79362596cdc9?w=600", caption: "<strong>æºªç•”æ‚ é–’æ¼«æ­¥</strong><br>æ²¿è‘—åº·èª¥æºªæ­¥é“ï¼Œä¸€é‚Šè³èŠ±ä¸€é‚Šè†è½æ½ºæ½ºæµæ°´è²ã€‚" }
                ],
                notices: ["èŠ±æœŸç´„ 2-3 é€±ï¼Œè«‹å¯†åˆ‡é—œæ³¨å®˜æ–¹å…¬å‘Š", "å¤œé–“é»ç‡ˆæ™‚é–“ï¼š18:00-21:00", "æ­¥é“éƒ¨åˆ†è·¯æ®µè¼ƒçª„ï¼Œè«‹æ³¨æ„å®‰å…¨", "è«‹å‹¿æ”€æŠ˜èŠ±æœ¨ï¼Œå…±åŒç¶­è­·ç¾æ™¯"]
            },
            "E03": {
                id: "E03", title: "æ±ç¢‡è·¯è¢ç«èŸ²", date: "2026/04/15", location: "æ±æ­¢æ±ç¢‡è·¯", query: "æ±æ­¢æ±ç¢‡è·¯ è¢ç«èŸ²",
                img: "https://images.unsplash.com/photo-1507400492013-162706c8c05e?w=800",
                desc: "å¤¢å¹»å¤œé–“å°æ—…è¡Œï¼æ¯å¹´å››æœˆè‡³äº”æœˆï¼Œæ±ç¢‡è·¯æ²¿ç·šæˆç‚ºè¢ç«èŸ²çš„å¤©å ‚ã€‚é»é»è¢å…‰åœ¨å±±æ—é–“é£›èˆï¼Œå½·å½¿ç½®èº«ç«¥è©±ä¸–ç•Œã€‚ç¾å ´æœ‰å°ˆæ¥­å°è¦½è§£èªªï¼Œå¸¶æ‚¨èªè­˜è¢ç«èŸ²çš„ç”Ÿæ…‹å¥§ç§˜ã€‚",
                tags: ["âœ¨ è¢ç«èŸ²", "ğŸŒ™ å¤œé–“å°è¦½", "ğŸŒ² ç”Ÿæ…‹ä¹‹æ—…", "ğŸ“· å¤œæ‹é«”é©—", "ğŸ’ è¦ªå­æ•™è‚²"],
                gallery: [
                    { img: "https://images.unsplash.com/photo-1528818955841-a7f1425c3e36?w=600", caption: "<strong>è¢å…‰é»é»å¤¢å¹»å¤œ</strong><br>æ•¸ä»¥åƒè¨ˆçš„è¢ç«èŸ²åœ¨é»‘æš—ä¸­é£›èˆï¼Œå¦‚åŒåœ°ä¸Šçš„éŠ€æ²³ã€‚" },
                    { img: "https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=600", caption: "<strong>å°ˆæ¥­ç”Ÿæ…‹å°è¦½</strong><br>ç”±åœ¨åœ°ç”Ÿæ…‹å°ˆå®¶å¸¶é ˜ï¼Œèªè­˜è¢ç«èŸ²çš„ä¸€ç”Ÿèˆ‡æ£²åœ°ä¿è‚²ã€‚" },
                    { img: "https://images.unsplash.com/photo-1542273917363-3b1817f69a2d?w=600", caption: "<strong>æ£®æ—æ­¥é“æ¢éšª</strong><br>ç©¿æ¢­åœ¨å¹½éœçš„å±±æ—æ­¥é“ï¼Œé«”é©—èˆ‡è‡ªç„¶æœ€è¦ªå¯†çš„æ¥è§¸ã€‚" }
                ],
                notices: ["è«‹ç©¿è‘—é•·è¢–é•·è¤²åŠåŒ…é‹", "ç¦æ­¢ä½¿ç”¨é–ƒå…‰ç‡ˆåŠæ‰‹é›»ç­’ç™½å…‰", "å»ºè­°æ”œå¸¶ç´…è‰²ç»ç’ƒç´™åŒ…è¦†æ‰‹é›»ç­’", "è«‹è¼•è²ç´°èªï¼Œå‹¿å¤§è²å–§å˜©", "è«‹å‹¿æ•æ‰è¢ç«èŸ²"]
            }
        };

        var pendingTask = null, leaveTime = 0, currentData = null, isEventPage = false;

        window.onload = function() {
            liff.init({ liffId: MY_LIFF_ID }).then(function() {
                renderContent();
            }).catch(function(err) { 
                console.error("LIFF error:", err); 
                renderContent(); 
            });
        };

        function renderContent() {
            try {
                var urlParams = new URLSearchParams(window.location.search);
                var pageId = urlParams.get('id') || 'spot1';

                if (pageId.indexOf('E') === 0 && eventsData[pageId]) {
                    isEventPage = true;
                    renderEventPage(pageId);
                } else {
                    isEventPage = false;
                    renderSpotPage(pageId);
                }
            } catch (e) {
                console.error("renderContent error:", e);
                document.getElementById('loading').innerHTML = '<div>è¼‰å…¥å¤±æ•—ï¼Œè«‹é‡æ–°æ•´ç†</div>';
            }
        }

        // ===== æ´»å‹•é é¢æ¸²æŸ“ =====
        function renderEventPage(eventId) {
            var data = eventsData[eventId];
            currentData = data;
            
            // éš±è—æ™¯é»å°ˆç”¨å…ƒç´ 
            document.getElementById('beacon-banner').style.display = 'none';
            document.getElementById('game-section').style.display = 'none';
            document.getElementById('survey-box').style.display = 'none';
            document.getElementById('memorial-box').style.display = 'none';
            document.getElementById('reset-link').style.display = 'none';
            document.getElementById('bus-schedule-link').style.display = 'none';
            document.getElementById('desc-actions').style.display = 'none';
            document.getElementById('wish-btn').style.display = 'none';
            document.querySelector('.progress-container').style.display = 'none';

            // é¡¯ç¤ºæ´»å‹•å°ˆç”¨å…ƒç´ 
            document.getElementById('tags-container').style.display = 'flex';
            document.getElementById('gallery-section').style.display = 'block';
            document.getElementById('notice-box').style.display = 'block';

            // æ¸²æŸ“åŸºæœ¬è³‡è¨Š
            document.getElementById('spot-img').src = data.img;
            document.getElementById('route-tag').innerHTML = '<span class="event-badge">ğŸª é™å®šæ´»å‹•</span>';
            document.getElementById('route-tag').style.background = 'transparent';
            document.getElementById('route-tag').style.padding = '0';
            document.getElementById('route-desc').innerHTML = 'ğŸ“… ' + data.date + ' ï½œ ğŸ“ ' + data.location;
            document.getElementById('spot-number').style.display = 'none';
            document.getElementById('spot-title').innerText = data.title;
            document.getElementById('spot-desc').innerText = data.desc;
            document.getElementById('spot-desc-container').classList.remove('expandable');

            // æ¸²æŸ“æ¨™ç±¤
            var tagsHtml = '';
            for (var i = 0; i < data.tags.length; i++) {
                tagsHtml += '<span class="tag">' + data.tags[i] + '</span>';
            }
            document.getElementById('tags-container').innerHTML = tagsHtml;

            // æ¸²æŸ“åœ–æ–‡èŠ±çµ®
            var galleryHtml = '';
            for (var j = 0; j < data.gallery.length; j++) {
                var item = data.gallery[j];
                galleryHtml += '<div class="gallery-item">';
                galleryHtml += '<img src="' + item.img + '" class="gallery-img" alt="æ´»å‹•èŠ±çµ®">';
                galleryHtml += '<div class="gallery-caption">' + item.caption + '</div>';
                galleryHtml += '</div>';
            }
            document.getElementById('gallery-content').innerHTML = galleryHtml;

            // æ¸²æŸ“æ³¨æ„äº‹é …
            var noticeHtml = '';
            for (var k = 0; k < data.notices.length; k++) {
                noticeHtml += '<li>' + data.notices[k] + '</li>';
            }
            document.getElementById('notice-list').innerHTML = noticeHtml;

            // è¨­å®šäº¤é€šæŒ‰éˆ•
            var mapQuery = encodeURIComponent(data.query);
            var busBtn = document.getElementById('bus-btn');
            busBtn.href = 'https://www.google.com/maps/search/?api=1&query=' + mapQuery;
            busBtn.className = 't-btn bg-nav';
            document.getElementById('bus-label').innerText = 'å°èˆªå‰å¾€';
            document.getElementById('parking-btn').href = 'https://www.google.com/maps/search/?api=1&query=' + mapQuery + '+åœè»Šå ´';

            // è¨­å®šåº•éƒ¨æŒ‰éˆ•
            document.getElementById('map-btn').href = 'https://www.google.com/maps/search/?api=1&query=' + mapQuery;
            document.getElementById('map-btn').innerHTML = 'ğŸ“ å°èˆªåˆ°æ´»å‹•åœ°é»';
            document.getElementById('map-btn').className = 'footer-btn btn-nav-main';
            document.getElementById('food-btn').href = 'https://www.google.com/maps/search/?api=1&query=' + mapQuery + '+ç¾é£Ÿ';

            // é¡¯ç¤ºé é¢
            document.getElementById('loading').style.display = 'none';
            document.getElementById('main-content').style.display = 'block';
        }

        // ===== æ™¯é»é é¢æ¸²æŸ“ =====
        function renderSpotPage(spotKey) {
            var data = spotsData[spotKey];
            if (!data) { data = spotsData['spot1']; spotKey = 'spot1'; }
            currentData = data;

            // é¡¯ç¤ºæ™¯é»å°ˆç”¨å…ƒç´ 
            document.getElementById('game-section').style.display = 'block';
            document.getElementById('bus-schedule-link').style.display = 'block';
            document.getElementById('desc-actions').style.display = 'flex';
            document.getElementById('wish-btn').style.display = 'block';
            document.getElementById('reset-link').style.display = 'block';
            document.querySelector('.progress-container').style.display = 'block';

            // éš±è—æ´»å‹•å°ˆç”¨å…ƒç´ 
            document.getElementById('tags-container').style.display = 'none';
            document.getElementById('gallery-section').style.display = 'none';
            document.getElementById('notice-box').style.display = 'none';

            // æ¸²æŸ“åŸºæœ¬è³‡è¨Š
            document.getElementById('spot-img').src = data.img;
            document.getElementById('spot-title').innerText = data.title;
            document.getElementById('spot-desc').innerText = data.desc;

            // è·¯ç·šè³‡è¨Š
            var routeKey = data.route || "R1";
            var rInfo = routesInfo[routeKey];
            if (rInfo) {
                document.getElementById('route-tag').innerText = rInfo.title;
                document.getElementById('route-desc').innerText = rInfo.desc;
                var spotIndex = rInfo.spots.indexOf(spotKey);
                if (spotIndex >= 0) {
                    document.getElementById('spot-number').innerText = "ç¬¬ " + (spotIndex + 1) + " ç«™ï¼Œå…± " + rInfo.spots.length + " ç«™";
                }
            }

            // è¨­å®šå•ç­”
            if (data.quizQ) {
                document.getElementById('quiz-question').innerText = data.quizQ;
                if (data.quizOpts) {
                    document.getElementById('quiz-opt-1').innerText = data.quizOpts[0];
                    document.getElementById('quiz-opt-2').innerText = data.quizOpts[1];
                    document.getElementById('quiz-opt-3').innerText = data.quizOpts[2];
                }
            }

            // è¨­å®šé€£çµ
            var mapQuery = encodeURIComponent(data.query);
            document.getElementById('map-btn').href = 'https://www.google.com/maps/search/?api=1&query=' + mapQuery;
            document.getElementById('food-btn').href = 'https://www.google.com/maps/search/?api=1&query=' + mapQuery + '+ç¾é£Ÿ';
            document.getElementById('parking-btn').href = 'https://www.google.com/maps/search/?api=1&query=' + mapQuery + '+åœè»Šå ´';

            // è¨­å®šä¸‹ä¸€ç«™æŒ‰éˆ•
            if (rInfo && rInfo.spots) {
                var currentIdx = rInfo.spots.indexOf(spotKey);
                var nextIdx = (currentIdx + 1) % rInfo.spots.length;
                var nextSpotKey = rInfo.spots[nextIdx];
                var nextData = spotsData[nextSpotKey];
                if (nextData) {
                    document.getElementById('bus-btn').href = 'https://www.google.com/maps/dir/?api=1&destination=' + encodeURIComponent(nextData.query) + '&travelmode=transit';
                    document.getElementById('bus-label').innerText = 'å»' + nextData.title;
                }
            }

            // Beacon æ¨¡æ“¬
            if (data.hasBeacon) {
                setTimeout(function() {
                    document.getElementById('beacon-banner').classList.add('show');
                    setTimeout(function() {
                        document.getElementById('beacon-banner').classList.remove('show');
                    }, 8000);
                }, 3000);
            }

            initTaskProgress();
            document.getElementById('loading').style.display = 'none';
            document.getElementById('main-content').style.display = 'block';
        }

        // ===== é›†é»åŠŸèƒ½ =====
        function collectAction(taskName) {
            var collected = JSON.parse(localStorage.getItem('xizhi_action_stamps')) || [];
            if (collected.indexOf(taskName) === -1) {
                collected.push(taskName);
                localStorage.setItem('xizhi_action_stamps', JSON.stringify(collected));
                setTimeout(initTaskProgress, 500);
            }
        }

        function handleClickWithTrack(taskName) { collectAction(taskName); }

        function isTaskDone(taskName) {
            var collected = JSON.parse(localStorage.getItem('xizhi_action_stamps')) || [];
            return collected.indexOf(taskName) !== -1;
        }

        function initTaskProgress() {
            var collected = JSON.parse(localStorage.getItem('xizhi_action_stamps')) || [];
            var icons = { 'map': 'ğŸ—ºï¸', 'quiz': 'â“', 'wish': 'â¤ï¸', 'beacon': 'ğŸ“¡', 'bus': 'ğŸšŒ' };
            
            for (var i = 0; i < TASKS.length; i++) {
                var task = TASKS[i];
                var el = document.getElementById('stamp-' + task);
                if (el) {
                    if (collected.indexOf(task) !== -1) {
                        el.classList.add('active');
                        el.innerText = 'âœ“';
                    } else {
                        el.classList.remove('active');
                        el.innerText = icons[task];
                    }
                }
            }

            var wishBtn = document.getElementById('wish-btn');
            if (collected.indexOf('wish') !== -1) {
                wishBtn.classList.add('active');
                wishBtn.innerHTML = 'â¤ï¸';
            }

            document.getElementById('progress-text').innerText = collected.length + '/5';
            document.getElementById('progress-bar').style.width = (collected.length / 5) * 100 + '%';

            if (collected.length >= 5) {
                document.getElementById('survey-box').style.display = 'block';
                document.getElementById('memorial-box').style.display = 'block';
            }
        }

        // ===== å…¶ä»–åŠŸèƒ½ =====
        function handleBeaconClick() {
            document.getElementById('beacon-banner').classList.remove('show');
            alert("ğŸ‰ æ­å–œï¼æ‚¨æ‰¾åˆ°äº†éš±è—è¨Šè™Ÿï¼\nç²å¾—ã€å°‹å¯¶å°ç« ã€‘");
            collectAction('beacon');
        }

        function openQuizModal() {
            if (isTaskDone('quiz')) { alert("é€™å€‹ä»»å‹™å·²ç¶“å®Œæˆå›‰ï¼"); return; }
            document.getElementById('quiz-modal').style.display = 'flex';
        }

        function checkQuiz(answerIdx) {
            var correctAnswer = currentData ? currentData.quizA : 2;
            if (answerIdx === correctAnswer) {
                document.getElementById('quiz-modal').style.display = 'none';
                alert("â­• ç­”å°äº†ï¼çœŸå²å®³ï¼\nç²å¾—ã€å•ç­”å°ç« ã€‘");
                collectAction('quiz');
            } else {
                alert("âŒ ç­”éŒ¯äº†ï¼Œè«‹å†è©¦è©¦çœ‹ï¼");
            }
        }

        function triggerWishlist() {
            var btn = document.getElementById('wish-btn');
            if (btn.classList.contains('active')) {
                btn.classList.remove('active');
                btn.innerHTML = 'â™¡';
                alert("å·²å¾æ¸…å–®ç§»é™¤");
            } else {
                btn.classList.add('active');
                btn.innerHTML = 'â¤ï¸';
                if (!isTaskDone('wish')) {
                    alert("å·²åŠ å…¥æœ€æ„›ï¼ç²å¾—ã€æƒ³å»å°ç« ã€‘");
                    collectAction('wish');
                } else {
                    alert("å·²åŠ å…¥æœ€æ„›ï¼");
                }
            }
        }

        function toggleDesc() {
            var container = document.getElementById('spot-desc-container');
            var btn = document.getElementById('read-more-btn');
            container.classList.toggle('expanded');
            btn.innerText = container.classList.contains('expanded') ? "â–² æ”¶èµ·ç°¡ä»‹" : "â–¼ äº†è§£æ›´å¤šæ•…äº‹";
        }

        function openShareModal() { document.getElementById('share-modal').style.display = 'flex'; }
        
        function closeModal(modalId, e) {
            if (e.target.id === modalId || e.target.classList.contains('close-modal')) {
                document.getElementById(modalId).style.display = 'none';
            }
        }

        function shareTo(platform) {
            var url = window.location.href;
            var title = document.getElementById('spot-title').innerText;
            var text = isEventPage ? 'ã€æ±æ­¢æ´»å‹•ã€‘' + title + 'ï¼Œå¿«ä¾†åƒåŠ ï¼' : 'æˆ‘æ­£åœ¨æ¢ç´¢æ±æ­¢æ·±åº¦å°è¦½ï¼š' + title + 'ï¼Œå¿«ä¾†çœ‹çœ‹ï¼';

            if (platform === 'line') {
                window.location.href = 'https://line.me/R/msg/text/?' + encodeURIComponent(text + ' ' + url);
            } else if (platform === 'fb') {
                window.open('https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(url));
            } else if (platform === 'copy') {
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(url).then(function() { alert("é€£çµå·²è¤‡è£½ï¼"); });
                }
            }
            document.getElementById('share-modal').style.display = 'none';
        }

        function resetProgress() {
            if (confirm("é‡ç½®æ‰€æœ‰é›†é»é€²åº¦ï¼Ÿ")) {
                localStorage.removeItem('xizhi_action_stamps');
                location.reload();
            }
        }

        function handleImageUpload(e) {
            var file = e.target.files[0];
            if (!file) return;
            var reader = new FileReader();
            reader.onload = function(event) {
                var img = new Image();
                img.onload = function() { drawCanvas(img); };
                img.src = event.target.result;
            };
            reader.readAsDataURL(file);
        }

        function drawCanvas(userImg) {
            var canvas = document.getElementById('result-canvas');
            var ctx = canvas.getContext('2d');
            var size = 800;
            canvas.width = size;
            canvas.height = size;
            var scale = Math.max(size / userImg.width, size / userImg.height);
            ctx.drawImage(userImg, (size / 2) - (userImg.width / 2) * scale, (size / 2) - (userImg.height / 2) * scale, userImg.width * scale, userImg.height * scale);
            var frameImg = new Image();
            frameImg.onload = function() {
                ctx.drawImage(frameImg, 0, 0, size, size);
                var finalImg = document.getElementById('final-img');
                finalImg.src = canvas.toDataURL("image/jpeg", 0.8);
                finalImg.style.display = "block";
                document.getElementById('download-msg').style.display = "block";
            };
            frameImg.src = FRAME_IMG_SRC;
        }
    </script>
</body>
</html>
