<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ±æ­¢æ·±åº¦å°è¦½</title>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        * { box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 0; background-color: #f4f7f6; color: #333; padding-bottom: 100px; }
        .progress-container { position: fixed; top: 0; left: 0; width: 100%; height: 6px; background: #e0e0e0; z-index: 2000; }
        .progress-bar { height: 100%; background: linear-gradient(90deg, #ff8a00, #e52e71); width: 0%; transition: width 0.5s ease; }
        .beacon-banner { position: fixed; top: -120px; left: 5%; width: 90%; background: rgba(34,34,34,0.95); color: white; padding: 12px 15px; border-radius: 50px; box-shadow: 0 8px 20px rgba(0,0,0,0.3); z-index: 5000; display: flex; align-items: center; gap: 12px; transition: top 0.6s cubic-bezier(0.175,0.885,0.32,1.275); cursor: pointer; }
        .beacon-banner.show { top: 20px; }
        .beacon-icon { width: 36px; height: 36px; background: #06C755; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .beacon-text { flex: 1; font-size: 13px; }
        .beacon-title { font-weight: bold; font-size: 14px; }
        .beacon-sub { color: #ccc; font-size: 11px; }
        .hero-container { position: relative; width: 100%; height: 35vh; overflow: hidden; }
        .hero-img { width: 100%; height: 100%; object-fit: cover; }
        .content-card { position: relative; background: white; border-radius: 24px 24px 0 0; margin-top: -25px; padding: 25px; box-shadow: 0 -5px 20px rgba(0,0,0,0.05); min-height: 60vh; }
        .title-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        h1 { margin: 0; font-size: 24px; font-weight: 800; color: #2c3e50; }
        .wish-btn { font-size: 22px; color: #ccc; cursor: pointer; padding: 5px; }
        .wish-btn.active { color: #ff4757; transform: scale(1.1); }
        .sub-tag { display: inline-block; font-size: 12px; color: #fff; background: #2c3e50; padding: 4px 10px; border-radius: 4px; margin-bottom: 10px; font-weight: bold; }
        .route-info { font-size: 13px; color: #666; margin-bottom: 15px; border-left: 3px solid #ff8a00; padding-left: 8px; }
        .spot-number { font-size: 12px; color: #888; margin-bottom: 5px; }
        .desc-box { margin-bottom: 20px; }
        .desc-text { font-size: 15px; line-height: 1.8; color: #555; }
        .desc-actions { display: flex; justify-content: space-between; align-items: center; margin-top: 12px; padding-bottom: 15px; border-bottom: 1px solid #eee; }
        .read-more-btn { color: #007bff; font-weight: bold; font-size: 14px; cursor: pointer; text-decoration: underline; }
        .quiz-trigger-btn { background: #ff9f43; color: white; padding: 6px 14px; border-radius: 20px; font-size: 13px; font-weight: bold; cursor: pointer; }
        .story-detail { display: none; margin-top: 20px; padding: 20px; background: #fafafa; border-radius: 16px; }
        .story-detail.show { display: block; animation: fadeIn 0.3s; }
        .story-section { margin-bottom: 20px; }
        .story-title { font-size: 16px; font-weight: bold; color: #2c3e50; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
        .story-title::before { content: ""; width: 4px; height: 16px; background: linear-gradient(180deg, #ff8a00, #e52e71); border-radius: 2px; }
        .story-text { font-size: 14px; line-height: 1.8; color: #555; text-align: justify; }
        .story-img { width: 100%; border-radius: 12px; margin: 15px 0; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .story-caption { font-size: 12px; color: #888; text-align: center; margin-top: -10px; margin-bottom: 15px; }
        .story-quote { background: #fff; border-left: 4px solid #ff8a00; padding: 15px; margin: 15px 0; font-style: italic; color: #666; border-radius: 0 8px 8px 0; }

        /* ç¾é£Ÿå€å¡Šæ¨£å¼ */
        .food-section { margin: 25px 0; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .section-title { font-size: 16px; font-weight: 800; color: #2c3e50; display: flex; align-items: center; gap: 8px; margin: 0; }
        .section-title::before { content: ""; width: 4px; height: 18px; background: linear-gradient(180deg, #ff6b6b, #ffa502); border-radius: 2px; }
        .more-link { font-size: 13px; color: #007bff; text-decoration: none; }
        .food-scroll { display: flex; gap: 12px; overflow-x: auto; padding-bottom: 10px; scroll-snap-type: x mandatory; -webkit-overflow-scrolling: touch; }
        .food-scroll::-webkit-scrollbar { display: none; }
        .food-card { min-width: 140px; max-width: 140px; background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); overflow: hidden; scroll-snap-align: start; cursor: pointer; transition: transform 0.2s; flex-shrink: 0; }
        .food-card:active { transform: scale(0.97); }
        .food-img { width: 100%; height: 90px; object-fit: cover; background: #f0f0f0; }
        .food-info { padding: 10px; }
        .food-name { font-size: 14px; font-weight: bold; color: #333; margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .food-type { font-size: 11px; color: #ff6b6b; background: #fff0f0; padding: 2px 8px; border-radius: 10px; display: inline-block; margin-bottom: 4px; }
        .food-desc { font-size: 11px; color: #888; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }

        .transport-grid { display: flex; gap: 10px; margin-bottom: 20px; }
        .t-btn { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 4px; padding: 10px; border-radius: 12px; text-decoration: none; color: white; font-weight: bold; font-size: 13px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); text-align: center; }
        .t-btn:active { transform: scale(0.96); }
        .t-btn i { font-style: normal; font-size: 18px; }
        .bg-ubike { background: linear-gradient(135deg, #fce38a, #f38181); color: #555; }
        .bg-bus { background: #3498db; }
        .bg-parking { background: #546de5; }
        .bus-label { font-size: 11px; }
        
        /* å…¬è»Šæ™‚åˆ»è¡¨æŒ‰éˆ•ç¾åŒ– */
        .bus-schedule-box { background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 12px; padding: 15px; margin-bottom: 20px; display: flex; align-items: center; gap: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .bus-schedule-icon { width: 44px; height: 44px; background: linear-gradient(135deg, #3498db, #2980b9); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 22px; flex-shrink: 0; }
        .bus-schedule-info { flex: 1; }
        .bus-schedule-title { font-size: 14px; font-weight: bold; color: #2c3e50; margin-bottom: 2px; }
        .bus-schedule-desc { font-size: 12px; color: #888; }
        .bus-schedule-btn { background: #3498db; color: white; padding: 8px 14px; border-radius: 20px; font-size: 12px; font-weight: bold; text-decoration: none; white-space: nowrap; }
        .bus-schedule-btn:active { transform: scale(0.95); }

        .game-section { background: #fff8e1; border: 2px dashed #ffc107; border-radius: 16px; padding: 20px; text-align: center; margin-bottom: 15px; }
        .game-title { font-weight: bold; color: #d35400; margin-bottom: 15px; font-size: 16px; }
        .task-grid { display: flex; justify-content: center; gap: 10px; }
        .stamp-box { display: flex; flex-direction: column; align-items: center; width: 55px; }
        .stamp { width: 40px; height: 40px; border-radius: 50%; background: #e0e0e0; color: #777; display: flex; align-items: center; justify-content: center; font-size: 18px; border: 2px solid #ddd; }
        .stamp.active { background: #ff512f; color: white; border-color: #ff512f; }
        .stamp-label { font-size: 10px; color: #888; margin-top: 5px; }
        #survey-box, #memorial-box { display: none; margin-top: 25px; }
        .survey-btn { display: block; background: linear-gradient(135deg, #667eea, #764ba2); color: white; text-align: center; padding: 16px; border-radius: 12px; text-decoration: none; font-weight: bold; }
        #memorial-box { text-align: center; background: #fafafa; padding: 20px; border-radius: 12px; }
        .upload-btn-wrapper { position: relative; overflow: hidden; display: inline-block; }
        .btn-upload { border: 2px dashed #007bff; color: #007bff; background: white; padding: 8px 16px; border-radius: 8px; font-weight: bold; }
        .upload-btn-wrapper input[type=file] { font-size: 100px; position: absolute; left: 0; top: 0; opacity: 0; }
        #result-canvas { display: none; }
        #final-img { width: 100%; max-width: 280px; border: 2px solid #28a745; display: none; margin: 10px auto; border-radius: 8px; }
        .download-hint { display: none; color: #28a745; font-size: 14px; margin-top: 10px; background: #e8f5e9; padding: 10px; border-radius: 8px; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 6000; display: none; align-items: flex-end; justify-content: center; }
        .share-sheet { width: 100%; max-width: 500px; background: white; border-radius: 20px 20px 0 0; padding: 25px; }
        .share-title { font-size: 16px; font-weight: bold; margin-bottom: 25px; text-align: center; }
        .share-grid { display: flex; justify-content: space-around; }
        .share-item { display: flex; flex-direction: column; align-items: center; gap: 10px; cursor: pointer; font-size: 12px; }
        .share-icon-box { width: 52px; height: 52px; border-radius: 14px; display: flex; align-items: center; justify-content: center; color: white; }
        .share-icon-box svg { width: 30px; height: 30px; fill: currentColor; }
        .quiz-box { background: white; width: 85%; max-width: 320px; padding: 20px; border-radius: 16px; text-align: center; align-self: center; }
        .quiz-question { font-size: 16px; font-weight: bold; margin-bottom: 20px; line-height: 1.5; }
        .quiz-options { display: flex; flex-direction: column; gap: 10px; }
        .quiz-btn { padding: 12px; border: 1px solid #ddd; background: #f8f9fa; border-radius: 8px; font-size: 14px; cursor: pointer; }
        .close-modal { margin-top: 15px; color: #999; font-size: 12px; text-decoration: underline; cursor: pointer; }

        /* æ–°ç‰ˆåº•éƒ¨æŒ‰éˆ• */
        .sticky-footer { position: fixed; bottom: 0; left: 0; width: 100%; background: white; padding: 10px 15px; display: flex; gap: 10px; box-shadow: 0 -4px 20px rgba(0,0,0,0.08); z-index: 1000; padding-bottom: max(10px, env(safe-area-inset-bottom)); }
        .footer-btn { flex: 1; padding: 12px; border-radius: 10px; text-align: center; text-decoration: none; font-weight: bold; font-size: 15px; display: flex; align-items: center; justify-content: center; gap: 6px; cursor: pointer; border: none; }
        .btn-map { background: #f1f3f5; color: #495057; }
        .btn-share { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }

        .reset-link { margin-top: 30px; text-align: center; font-size: 12px; color: #ccc; text-decoration: underline; cursor: pointer; }
        #loading { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; display: flex; align-items: center; justify-content: center; z-index: 3000; color: #888; }
        .tags-container { display: none; flex-wrap: wrap; gap: 8px; margin: 15px 0; }
        .tag { background: #fff0f0; color: #ff6b6b; padding: 6px 14px; border-radius: 20px; font-size: 13px; }
        #gallery-section, #notice-box { display: none; }
        .gallery-item { margin-bottom: 20px; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .gallery-img { width: 100%; height: 180px; object-fit: cover; }
        .gallery-caption { padding: 12px; background: #fafafa; font-size: 14px; color: #666; }
        .notice-box { background: #fff8e1; border-left: 4px solid #ffc107; padding: 15px; border-radius: 0 12px 12px 0; margin: 20px 0; }
        .notice-box h4 { margin: 0 0 10px; color: #f57c00; font-size: 14px; }
        .notice-box ul { margin: 0; padding-left: 20px; font-size: 13px; color: #666; line-height: 1.8; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>
    <div id="loading"><div>â³ è¼‰å…¥ä¸­...</div></div>
    <div class="progress-container"><div id="progress-bar" class="progress-bar"></div></div>
    <div id="beacon-banner" class="beacon-banner" onclick="handleBeaconClick()">
        <div class="beacon-icon">ğŸ“¡</div>
        <div class="beacon-text"><div class="beacon-title">åµæ¸¬åˆ° LINE Beacon è¨Šè™Ÿ</div><div class="beacon-sub">é™„è¿‘æœ‰éš±è—æ™¯é»ï¼é»æ“Šæ‰“å¡</div></div>
    </div>
    <div id="main-content" style="display: none;">
        <div class="hero-container"><img id="spot-img" class="hero-img" src="" alt="åœ–ç‰‡"></div>
        <div class="content-card">
            <span id="route-tag" class="sub-tag">æ±æ­¢å°è¦½</span>
            <div id="route-desc" class="route-info"></div>
            <div id="spot-number" class="spot-number"></div>
            <div class="title-row">
                <h1 id="spot-title"></h1>
                <div id="wish-btn" class="wish-btn" onclick="triggerWishlist()">â™¡</div>
            </div>
            <div class="desc-box">
                <div id="spot-desc" class="desc-text"></div>
                <div id="desc-actions" class="desc-actions">
                    <div id="read-more-btn" class="read-more-btn" onclick="toggleStory()">â–¼ äº†è§£æ›´å¤šæ•…äº‹</div>
                    <div id="quiz-btn" class="quiz-trigger-btn" onclick="openQuizModal()">ğŸ§  çŸ¥è­˜å°å­¸å ‚</div>
                </div>
            </div>
            <div id="story-detail" class="story-detail"></div>

            <!-- ç¾é£Ÿæ¨è–¦å€å¡Š -->
            <div id="food-section" class="food-section">
                <div class="section-header">
                    <div class="section-title">ğŸœ é™„è¿‘æ¨è–¦ç¾é£Ÿ</div>
                    <a id="more-food-link" href="#" target="_blank" class="more-link">æ›´å¤šç¾é£Ÿ â†’</a>
                </div>
                <div id="food-scroll" class="food-scroll"></div>
            </div>

            <div id="tags-container" class="tags-container"></div>
            <div id="gallery-section"><div class="section-title">æ´»å‹•èŠ±çµ®</div><div id="gallery-content"></div></div>
            <div id="notice-box" class="notice-box"><h4>ğŸ“Œ åƒåŠ é ˆçŸ¥</h4><ul id="notice-list"></ul></div>

            <div class="transport-grid">
                <a href="https://www.google.com/maps/search/YouBike/" target="_blank" class="t-btn bg-ubike"><i>ğŸš²</i> YouBike</a>
                <a id="bus-btn" href="#" target="_blank" class="t-btn bg-bus" onclick="collectAction('bus')"><i>ğŸšŒ</i> <span id="bus-label" class="bus-label">å»ä¸‹ä¸€ç«™</span></a>
                <a id="parking-btn" href="#" target="_blank" class="t-btn bg-parking"><i>ğŸ…¿ï¸</i> æ‰¾åœè»Šå ´</a>
            </div>
            <!-- å…¬è»Šæ™‚åˆ»è¡¨ç¾åŒ–ç‰ˆ -->
            <div id="bus-schedule-link" class="bus-schedule-box">
                <div class="bus-schedule-icon">ğŸšŒ</div>
                <div class="bus-schedule-info">
                    <div class="bus-schedule-title">Fç³»åˆ—ç¤¾å€å·´å£«</div>
                    <div class="bus-schedule-desc">æŸ¥çœ‹å®Œæ•´æ™‚åˆ»è¡¨èˆ‡è·¯ç·šåœ–</div>
                </div>
                <a href="https://www.xizhi.ntpc.gov.tw/home.jsp?id=1ee324bfb5e44418" target="_blank" class="bus-schedule-btn">æŸ¥çœ‹ â†’</a>
            </div>
            <div id="game-section" class="game-section">
                <div class="game-title">ğŸ† æ±æ­¢é”äººæŒ‘æˆ° (é€²åº¦: <span id="progress-text">0/5</span>)</div>
                <div class="task-grid">
                    <div class="stamp-box"><div class="stamp" id="stamp-map">ğŸ—ºï¸</div><div class="stamp-label">æ‰¾è·¯</div></div>
                    <div class="stamp-box"><div class="stamp" id="stamp-quiz">â“</div><div class="stamp-label">å•ç­”</div></div>
                    <div class="stamp-box"><div class="stamp" id="stamp-wish">â¤ï¸</div><div class="stamp-label">æƒ³å»</div></div>
                    <div class="stamp-box"><div class="stamp" id="stamp-beacon">ğŸ“¡</div><div class="stamp-label">å°‹å¯¶</div></div>
                    <div class="stamp-box"><div class="stamp" id="stamp-share">ğŸ“¤</div><div class="stamp-label">åˆ†äº«</div></div>
                </div>
            </div>
            <div id="survey-box"><a href="#" class="survey-btn">ğŸ“ ä»»å‹™é”æˆï¼å¡«å¯«å•å·é ˜å–è­‰æ›¸</a></div>
            <div id="memorial-box">
                <div style="font-size:16px;font-weight:800;margin-bottom:5px;">ğŸ å®Œè³½ç´€å¿µç…§</div>
                <p style="font-size:13px;color:#666;margin-bottom:15px;">ä¸Šå‚³è‡ªæ‹ç…§ï¼Œåˆæˆæ±æ­¢é”äººç›¸æ¡†ï¼</p>
                <div class="upload-btn-wrapper"><button class="btn-upload">ğŸ“¸ é¸æ“‡ç…§ç‰‡</button><input type="file" accept="image/*" onchange="handleImageUpload(event)"></div>
                <canvas id="result-canvas"></canvas>
                <img id="final-img" src="" alt=""><div id="download-msg" class="download-hint">ğŸ‘† é•·æŒ‰åœ–ç‰‡å„²å­˜</div>
            </div>
            <!-- éš±è—çš„é‡ç½®æŒ‰éˆ•ï¼Œéœ€é•·æŒ‰éŠæˆ²å€å¡Š3ç§’æ‰æœƒé¡¯ç¤º -->
            <div id="reset-link" class="reset-link" style="display:none;" onclick="resetProgress()">â†º é‡ç½®æ¸¬è©¦é€²åº¦</div>
            <!-- é•·æŒ‰è§¸ç™¼å€ï¼ˆç‰ˆæœ¬è™Ÿï¼‰ -->
            <div id="dev-trigger" style="text-align:center; padding: 20px 0; color: #ddd; font-size: 11px; user-select: none;">v2.0</div>
        </div>
    </div>

    <!-- æ–°ç‰ˆåº•éƒ¨æŒ‰éˆ•ï¼šå¸¶æˆ‘å» + æ‰“å¡åˆ†äº« -->
    <div class="sticky-footer">
        <a id="map-btn" href="#" class="footer-btn btn-map" target="_blank" onclick="handleClickWithTrack('map')">ğŸ“ å¸¶æˆ‘å»</a>
        <button class="footer-btn btn-share" onclick="handleShareWithStamp()">ğŸ“¸ æ‰“å¡åˆ†äº«</button>
    </div>

    <div id="share-modal" class="modal-overlay" onclick="closeModal('share-modal',event)">
        <div class="share-sheet">
            <div class="share-title">ğŸ“¸ æ‰“å¡åˆ†äº«</div>
            <div class="share-grid">
                <div class="share-item" onclick="shareTo('line')"><div class="share-icon-box" style="background:#06C755;"><svg viewBox="0 0 24 24"><path d="M22 10.3c0-4.7-4.3-8.6-10-8.6-5.4 0-10 3.9-10 8.6 0 4.2 3.8 7.8 8.4 8.5.3 0 .7.2.8.5l.3 1.3c-.1.5-.4 1.8-1.7 2.5 1.4 0 4.3-.9 6-3.1 3.5-1.5 6.2-4.8 6.2-9.7z"/></svg></div><span>LINE</span></div>
                <div class="share-item" onclick="shareTo('fb')"><div class="share-icon-box" style="background:#1877F2;"><svg viewBox="0 0 24 24"><path d="M22 12c0-5.5-4.5-10-10-10S2 6.5 2 12c0 5 3.7 9.1 8.4 9.9v-7H7.9V12h2.5V9.8c0-2.5 1.5-3.9 3.8-3.9 1.1 0 2.2.2 2.2.2v2.5h-1.3c-1.2 0-1.6.8-1.6 1.6V12h2.8l-.4 2.9h-2.4v7C18.3 21.1 22 17 22 12z"/></svg></div><span>Facebook</span></div>
                <div class="share-item" onclick="shareTo('ig')"><div class="share-icon-box" style="background:linear-gradient(45deg,#f09433,#e6683c,#dc2743,#cc2366,#bc1888);"><svg viewBox="0 0 24 24"><path d="M12 2.2c3.2 0 3.6 0 4.8.1 1.2.1 1.8.2 2.2.4.6.2 1 .5 1.4.9.4.4.7.8.9 1.4.2.4.4 1.1.4 2.2.1 1.3.1 1.6.1 4.8s0 3.6-.1 4.8c-.1 1.2-.2 1.8-.4 2.2-.2.6-.5 1-.9 1.4-.4.4-.8.7-1.4.9-.4.2-1.1.4-2.2.4-1.3.1-1.6.1-4.8.1s-3.6 0-4.8-.1c-1.2-.1-1.8-.2-2.2-.4-.6-.2-1-.5-1.4-.9-.4-.4-.7-.8-.9-1.4-.2-.4-.4-1.1-.4-2.2-.1-1.3-.1-1.6-.1-4.8s0-3.6.1-4.8c.1-1.2.2-1.8.4-2.2.2-.6.5-1 .9-1.4.4-.4.8-.7 1.4-.9.4-.2 1.1-.4 2.2-.4 1.2-.1 1.6-.1 4.8-.1M12 0C8.7 0 8.3 0 7.1.1 5.8.1 4.9.3 4.1.6c-.8.3-1.5.7-2.2 1.4C1.2 2.6.8 3.3.5 4.1c-.3.8-.5 1.7-.5 3 0 1.2 0 1.6 0 4.9s0 3.7.1 4.9c.1 1.3.3 2.1.6 2.9.3.8.7 1.5 1.4 2.2.7.7 1.4 1.1 2.2 1.4.8.3 1.6.5 2.9.6 1.2.1 1.6.1 4.9.1s3.7 0 4.9-.1c1.3-.1 2.1-.3 2.9-.6.8-.3 1.5-.7 2.2-1.4.7-.7 1.1-1.4 1.4-2.2.3-.8.5-1.6.6-2.9.1-1.2.1-1.6.1-4.9s0-3.7-.1-4.9c-.1-1.3-.3-2.1-.6-2.9-.3-.8-.7-1.5-1.4-2.2-.7-.7-1.4-1.1-2.2-1.4-.8-.3-1.6-.5-2.9-.6C15.7 0 15.3 0 12 0zm0 5.8c-3.4 0-6.2 2.8-6.2 6.2s2.8 6.2 6.2 6.2 6.2-2.8 6.2-6.2-2.8-6.2-6.2-6.2zm0 10.2c-2.2 0-4-1.8-4-4s1.8-4 4-4 4 1.8 4 4-1.8 4-4 4zm6.4-11.8c-.8 0-1.4.6-1.4 1.4 0 .8.6 1.4 1.4 1.4.8 0 1.4-.6 1.4-1.4 0-.8-.6-1.4-1.4-1.4z"/></svg></div><span>Instagram</span></div>
                <div class="share-item" onclick="shareTo('copy')"><div class="share-icon-box" style="background:#555;"><svg viewBox="0 0 24 24"><path d="M16 1H4C2.9 1 2 1.9 2 3V17H4V3H16V1ZM19 5H8C6.9 5 6 5.9 6 7V21C6 22.1 6.9 23 8 23H19C20.1 23 21 22.1 21 21V7C21 5.9 20.1 5 19 5ZM19 21H8V7H19V21Z"/></svg></div><span>è¤‡è£½é€£çµ</span></div>
            </div>
        </div>
    </div>
    <div id="quiz-modal" class="modal-overlay">
        <div class="quiz-box">
            <div id="quiz-question" class="quiz-question">Q: å•é¡Œè¼‰å…¥ä¸­...</div>
            <div class="quiz-options">
                <button class="quiz-btn" id="quiz-opt-1" onclick="checkQuiz(1)">A</button>
                <button class="quiz-btn" id="quiz-opt-2" onclick="checkQuiz(2)">B</button>
                <button class="quiz-btn" id="quiz-opt-3" onclick="checkQuiz(3)">C</button>
            </div>
            <div class="close-modal" onclick="closeModal('quiz-modal',event)">æ”¾æ£„æŒ‘æˆ°</div>
        </div>
    </div>
<script>
var MY_LIFF_ID = "2008941841-8KQq29wn";
var TASKS = ['map','quiz','wish','beacon','share'];
var routesInfo = {
    "R1": { title: "ä¸€èŒ¶ä¸€ç¤¦", desc: "æ¸…ä»£åŒ…ç¨®èŒ¶èˆ‡æ—¥æ²»ç…¤ç¤¦çš„é›™è»Œæ™‚å…‰", spots: ["spot1","spot2","spot3","spot4","spot5","spot6","spot7","spot8","spot9"] },
    "R2": { title: "å±±æ—ç§˜å¢ƒ", desc: "èµ°é€²å¾Œå±±ï¼Œçœºæœ›è‡ºåŒ—ç›†åœ°çš„é¼é—˜æ™¯ç·»", spots: ["spot1","spot10","spot11","spot12","spot13","spot14"] },
    "R3": { title: "ç¶²ç¾æ‰“å¡", desc: "å¾å½äº¬éƒ½åˆ°å¤¢å¹»æ¹–æ™¯", spots: ["spot15","spot16","spot17","spot18","spot19"] },
    "R4": { title: "ç™¾å¹´ä¿¡ä»°", desc: "è§£è®€æ±æ­¢çš„å¤šå±¤ä¿¡ä»°èˆ‡æ­·å²å¢“åœ’", spots: ["spot1","spot20","spot21","spot22","spot23"] }
};

// ç¾é£Ÿè³‡æ–™ï¼ˆç¤ºç¯„ç”¨ï¼Œä¹‹å¾Œå¯æ“´å……ï¼‰
var foodsData = {
    "spot1": [ // æ±æ­¢ç«è»Šç«™
        { name: "é˜¿è²¡é‹è²¼", type: "å°åƒ", desc: "åœ¨åœ°30å¹´è€åº—ï¼Œçš®è„†é¤¡å¤šæ±", img: "https://images.unsplash.com/photo-1496116218417-1a781b1c416c?w=300", query: "æ±æ­¢é˜¿è²¡é‹è²¼" },
        { name: "æ±æ­¢è§€å…‰å¤œå¸‚", type: "å¤œå¸‚", desc: "é€±ä¸‰ã€å…­ç‡Ÿæ¥­ï¼Œåœ¨åœ°äººæ¨è–¦", img: "https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=300", query: "æ±æ­¢è§€å…‰å¤œå¸‚" },
        { name: "æ­£è€ç‰Œè±†èŠ±", type: "ç”œé»", desc: "å¤æ—©å‘³è±†èŠ±ï¼Œé…æ–™è±å¯Œ", img: "https://images.unsplash.com/photo-1563805042-7684c019e1cb?w=300", query: "æ±æ­¢æ­£è€ç‰Œè±†èŠ±" }
    ],
    "spot2": [ // æ¿Ÿå¾·å®®
        { name: "å»Ÿå£è‚‰åœ“", type: "å°åƒ", desc: "æ‹œæ‹œå®Œå¿…åƒï¼Œçš®Qé¤¡é¦™", img: "https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?w=300", query: "æ±æ­¢å»Ÿå£è‚‰åœ“" },
        { name: "è€è¡—ç¢—ç²¿", type: "å°åƒ", desc: "å‚³çµ±æ‰‹å·¥ç¢—ç²¿ï¼Œé†¬æ–™ç¨ç‰¹", img: "https://images.unsplash.com/photo-1547592180-85f173990554?w=300", query: "æ±æ­¢è€è¡—ç¢—ç²¿" }
    ],
    "spot7": [ // æ˜Ÿå…‰æ©‹
        { name: "æ²³å²¸å’–å•¡", type: "å’–å•¡", desc: "çœ‹å¤œæ™¯é…å’–å•¡ï¼Œæµªæ¼«æ»¿åˆ†", img: "https://images.unsplash.com/photo-1509042239860-f550ce710b93?w=300", query: "æ±æ­¢æ˜Ÿå…‰æ©‹å’–å•¡" },
        { name: "æ©‹é ­é¹¹é…¥é›", type: "å°åƒ", desc: "åœ¨åœ°äººæ°£ç‚¸ç‰©æ”¤", img: "https://images.unsplash.com/photo-1562967914-608f82629710?w=300", query: "æ±æ­¢æ©‹é ­é¹¹é…¥é›" }
    ],
    "spot16": [ // æ‹±åŒ—æ®¿
        { name: "å±±ä¸­èŒ¶å±‹", type: "èŒ¶é¤¨", desc: "è³æ¥“é…ç†±èŒ¶ï¼Œå¤è‰²å¤é¦™", img: "https://images.unsplash.com/photo-1544787219-7f47ccb76574?w=300", query: "æ±æ­¢æ‹±åŒ—æ®¿èŒ¶å±‹" },
        { name: "ç´ é£Ÿé¤å»³", type: "ç´ é£Ÿ", desc: "å»Ÿæ–¹æ¨è–¦ï¼Œæ¸…æ·¡é¤Šç”Ÿ", img: "https://images.unsplash.com/photo-1512621776951-a57141f2eefd?w=300", query: "æ±æ­¢æ‹±åŒ—æ®¿ç´ é£Ÿ" }
    ],
    "spot17": [ // æ–°å±±å¤¢æ¹–
        { name: "å¤¢æ¹–å’–å•¡", type: "å’–å•¡", desc: "æ¹–ç•”æ™¯è§€å’–å•¡ï¼Œé©åˆç´„æœƒ", img: "https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?w=300", query: "æ–°å±±å¤¢æ¹–å’–å•¡" },
        { name: "å±±ç”¢æ–™ç†", type: "é¤å»³", desc: "æ–°é®®å±±ç”¢ï¼Œé“åœ°é¢¨å‘³", img: "https://images.unsplash.com/photo-1476224203421-9ac39bcb3327?w=300", query: "æ±æ­¢å¤¢æ¹–å±±ç”¢" }
    ],
    "default": [ // é è¨­ç¾é£Ÿ
        { name: "æ±æ­¢å°åƒè¡—", type: "å°åƒ", desc: "å„å¼å‚³çµ±å°åƒèšé›†åœ°", img: "https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=300", query: "æ±æ­¢å°åƒ" },
        { name: "åœ¨åœ°æ—©é¤åº—", type: "æ—©é¤", desc: "éŠ…æ¿åƒ¹ç¾å‘³æ—©é»", img: "https://images.unsplash.com/photo-1525351484163-7529414344d8?w=300", query: "æ±æ­¢æ—©é¤" }
    ]
};

var spotsData = {
    "spot1": { id:1, route:"R1", title:"æ±æ­¢ç«è»Šç«™", img:"https://upload.wikimedia.org/wikipedia/commons/thumb/6/66/TRA_Xizhi_Station_202308.jpg/800px-TRA_Xizhi_Station_202308.jpg", desc:"æ—…ç¨‹èµ·é»ã€‚ã€Œæ±æ­¢ã€èˆŠç¨±ã€Œæ°´è¿”è…³ã€ï¼Œæ„æŒ‡åŸºéš†æ²³æ½®æ±è‡³æ­¤è€Œè¿”ã€‚ç«™å‰å»£å ´æ˜¯æ„Ÿå—åœ¨åœ°æ´»åŠ›çš„æœ€ä½³èµ·é»ã€‚", query:"æ±æ­¢ç«è»Šç«™", hasBeacon:true, quizQ:"Q: æ±æ­¢èˆŠç¨±ä»€éº¼ï¼Ÿ", quizA:2, quizOpts:["A. é›ç± ","B. æ°´è¿”è…³","C. è‰‹èˆº"], story:{ sections:[{title:"æ°´è¿”è…³çš„ç”±ä¾†",text:"ã€Œæ°´è¿”è…³ã€é€™å€‹åå­—æºè‡ªå¹³åŸ”æ—èªï¼Œæ„æŒ‡ã€Œæ½®æ°´æ¼²åˆ°é€™è£¡å°±æŠ˜è¿”ã€ã€‚æ¸…ä»£æ™‚æœŸï¼ŒåŸºéš†æ²³æ˜¯é‡è¦çš„é‹è¼¸èˆªé“ã€‚"},{title:"è»Šç«™çš„æ¼”è®Š",text:"æ±æ­¢ç«è»Šç«™å§‹å»ºæ–¼1891å¹´ï¼Œæ˜¯è‡ºç£éµè·¯æœ€æ—©çš„è»Šç«™ä¹‹ä¸€ã€‚"}],quote:"ã€Œæ±æ­¢ï¼Œæ½®ä¾†æ½®å¾€ä¹‹åœ°ï¼Œæ˜¯ä¸€åº§è¢«æ²³æµèˆ‡éµé“ä¸²é€£çš„åŸå¸‚ã€‚ã€"}},
    "spot2": { id:2, route:"R1", title:"æ¿Ÿå¾·å®®", img:"https://tour.ntpc.gov.tw/Content/Upload/Place/6d368051-9e7f-44e8-8a4e-1b8f5745778a.jpg", desc:"ä¿—ç¨±æ±æ­¢åª½ç¥–å»Ÿï¼Œæ˜¯ã€Šé€šéˆå°‘å¥³ã€‹å–æ™¯åœ°ï¼Œè¦‹è­‰è€è¡—èˆˆè¡°ã€‚", query:"æ±æ­¢æ¿Ÿå¾·å®®", hasBeacon:false, quizQ:"Q: æ¿Ÿå¾·å®®æ›¾æ˜¯å“ªéƒ¨æˆ²åŠ‡çš„å–æ™¯åœ°ï¼Ÿ", quizA:1, quizOpts:["A. é€šéˆå°‘å¥³","B. èŠ±ç”²ç”·å­©","C. ä¿—å¥³é¤Šæˆè¨˜"], story:{ sections:[{title:"ç™¾å¹´åª½ç¥–ä¿¡ä»°",text:"æ¿Ÿå¾·å®®å‰µå»ºæ–¼æ¸…å’¸è±å¹´é–“ï¼ˆç´„1856å¹´ï¼‰ï¼Œä¸»ç¥€å¤©ä¸Šè–æ¯åª½ç¥–ã€‚"}],quote:"ã€Œæ¿Ÿå¾·å®®ä¸åªæ˜¯ä¿¡ä»°ä¸­å¿ƒï¼Œæ›´æ˜¯æ±æ­¢äººå…±åŒçš„è¨˜æ†¶ã€‚ã€"}},
    "spot3": { id:3, route:"R1", title:"è˜‡å®¶å¤å", img:"https://newtaipei.travel/content/images/attractions/26786/1024x768_attractions-image-j1o3r4gbu06342s3z9s-qa.jpg", desc:"ç´…ç£šæ‹±å»Šçš„ç™¾å¹´èŒ¶å•†å®…é‚¸ï¼Œè¦‹è­‰æ±æ­¢èŒ¶è‘‰å¤–éŠ·é»ƒé‡‘å¹´ä»£ã€‚", query:"æ±æ­¢è˜‡å®¶å¤å", hasBeacon:false, quizQ:"Q: è˜‡å®¶å¤åè¦‹è­‰äº†ä»€éº¼ç”¢æ¥­ï¼Ÿ", quizA:2, quizOpts:["A. ç…¤ç¤¦","B. èŒ¶è‘‰å¤–éŠ·","C. æ¼æ¥­"], story:{ sections:[{title:"èŒ¶å•†ä¸–å®¶",text:"è˜‡å®¶å¤åå»ºæ–¼1920å¹´ä»£ï¼Œæ˜¯ç•¶æ™‚æ±æ­¢é¦–å±ˆä¸€æŒ‡çš„èŒ¶å•†å®¶æ—å®…é‚¸ã€‚"}],quote:"ã€Œä¸€æ¯èŒ¶ï¼Œä¸€æ®µæ­·å²ã€‚ã€"}},
    "spot4": { id:4, route:"R1", title:"æ±æ­¢è€è¡—", img:"https://tour.ntpc.gov.tw/Content/Upload/Place/ed979927-567c-48c9-947b-1178c520857b.jpg", desc:"ä¸­æ­£è€è¡—ï¼Œæ¸…ä»£ã€Œå³°ä»”å³™åº„ã€å•†æ¥­è¡—éºè·¡ã€‚", query:"æ±æ­¢ä¸­æ­£è€è¡—", hasBeacon:false, quizQ:"Q: æ±æ­¢è€è¡—çš„æ¸…ä»£åç¨±æ˜¯ï¼Ÿ", quizA:3, quizOpts:["A. æ°´è¿”è…³è¡—","B. åŸºéš†è¡—","C. å³°ä»”å³™åº„"], story:{ sections:[{title:"ç¹è¯èˆŠå¤¢",text:"æ±æ­¢è€è¡—æ›¾æ˜¯æ¸…ä»£å•†æ¥­ä¸­å¿ƒã€‚"}],quote:"ã€Œè€è¡—çš„æ¯å¡Šç£šçŸ³ï¼Œéƒ½æ˜¯æ­·å²çš„å°è¨˜ã€‚ã€"}},
    "spot5": { id:5, route:"R1", title:"å»ºé †èŒ¶è¡Œ", img:"https://newtaipei.travel/content/images/attractions/41830/1024x768_attractions-image-1.jpg", desc:"å‰µç«‹æ–¼1885å¹´ï¼Œæ±æ­¢ç¾å­˜æœ€å¤è€çš„èŒ¶è¡Œã€‚", query:"æ±æ­¢å»ºé †èŒ¶è¡Œ", hasBeacon:true, quizQ:"Q: å»ºé †èŒ¶è¡Œå‰µç«‹æ–¼å“ªä¸€å¹´ï¼Ÿ", quizA:1, quizOpts:["A. 1885å¹´","B. 1900å¹´","C. 1920å¹´"], story:{ sections:[{title:"ç™¾å¹´èŒ¶é¦™",text:"å»ºé †èŒ¶è¡Œå‚³æ‰¿å››ä»£ï¼Œå …æŒæ‰‹å·¥è£½èŒ¶ã€‚"}],quote:"ã€Œä¸€ç™¾å¤šå¹´çš„æ™‚å…‰ï¼Œåªåšä¸€ä»¶äº‹â€”â€”è£½å¥½èŒ¶ã€‚ã€"}},
    "spot6": { id:6, route:"R1", title:"èŒ„è‹³è…³éµè·¯éºè·¡", img:"https://tour.ntpc.gov.tw/Content/Upload/Place/6d368051-9e7f-44e8-8a4e-1b8f5745778a.jpg", desc:"ä¿ç•™æ¸…é ˜è‡³æ—¥æ²»éµè·¯åŸºåº§ï¼Œéµé“è¿·å¿…è¨ªã€‚", query:"æ±æ­¢èŒ„è‹³è…³éµè·¯éºè·¡", hasBeacon:false, quizQ:"Q: èŒ„è‹³è…³éºè·¡ä¿ç•™äº†ä»€éº¼ï¼Ÿ", quizA:2, quizOpts:["A. å¤äº•","B. éµè·¯åŸºåº§","C. åŸç‰†"], story:{ sections:[{title:"éµé“è¨˜æ†¶",text:"é€™è£¡æ›¾æ˜¯é‹é€ç…¤ç¤¦çš„é‡è¦è·¯æ®µã€‚"}],quote:"ã€Œéµè»Œå·²ä¸åœ¨ï¼Œä½†æ­·å²ç—•è·¡ä¾ç„¶æ¸…æ™°ã€‚ã€"}},
    "spot7": { id:7, route:"R1", title:"æ˜Ÿå…‰æ©‹", img:"https://newtaipei.travel/content/images/attractions/26815/1024x768_attractions-image-w4q9s3h5g06342s3z9s-qa.jpg", desc:"éº¥å…‹é¢¨é€ å‹æ™¯è§€æ©‹ï¼Œå¤œé–“æ”å½±ç†±é»ã€‚", query:"æ±æ­¢æ˜Ÿå…‰æ©‹", hasBeacon:true, quizQ:"Q: æ˜Ÿå…‰æ©‹çš„é€ å‹åƒä»€éº¼ï¼Ÿ", quizA:3, quizOpts:["A. å‰ä»–","B. å¸†èˆ¹","C. éº¥å…‹é¢¨"], story:{ sections:[{title:"åŸå¸‚æ–°åœ°æ¨™",text:"æ˜Ÿå…‰æ©‹æ–¼2014å¹´å•Ÿç”¨ï¼Œæ©‹å¡”é«˜75å…¬å°ºã€‚"}],quote:"ã€Œæ˜Ÿå…‰æ©‹ï¼Œé€£æ¥äº†æ±æ­¢çš„éå»èˆ‡æœªä¾†ã€‚ã€"}},
    "spot8": { id:8, route:"R1", title:"æ±å±±ç…¤ç¤¦éºè·¡", img:"https://newtaipei.travel/content/images/attractions/26815/1024x768_attractions-image-w4q9s3h5g06342s3z9s-qa.jpg", desc:"åŒ—å°ç£ç…¤ç¤¦ç”¢åœ°éºè·¡ï¼Œé»‘é‡‘æ­²æœˆã€‚", query:"æ±æ­¢æ±å±±ç…¤ç¤¦", hasBeacon:false, quizQ:"Q: æ±æ­¢æ›¾æ˜¯ä»€éº¼é‡è¦ç”¢åœ°ï¼Ÿ", quizA:1, quizOpts:["A. ç…¤ç¤¦","B. é‡‘ç¤¦","C. éŠ…ç¤¦"], story:{ sections:[{title:"é»‘é‡‘æ­²æœˆ",text:"æ±æ­¢æ›¾æ˜¯åŒ—å°ç£é‡è¦çš„ç…¤ç¤¦ç”¢åœ°ã€‚"}],quote:"ã€Œæ¯ä¸€å¡Šç…¤ç‚­ï¼Œéƒ½æµ¸é€è‘—ç¤¦å·¥çš„æ±—æ°´ã€‚ã€"}},
    "spot9": { id:9, route:"R1", title:"äº”å µéµè·¯éš§é“", img:"https://newtaipei.travel/content/images/attractions/26786/1024x768_attractions-image-j1o3r4gbu06342s3z9s-qa.jpg", desc:"æ—¥æ²»ç´…ç£šéš§é“ï¼Œç¥éš±å°‘å¥³æ°›åœã€‚", query:"äº”å µå°éµèˆŠéš§é“", hasBeacon:false, quizQ:"Q: äº”å µéš§é“ç¾åœ¨çš„ç”¨é€”æ˜¯ï¼Ÿ", quizA:2, quizOpts:["A. ç«è»Šé€šè¡Œ","B. è‡ªè¡Œè»Šé“","C. æ­¥é“"], story:{ sections:[{title:"ç©¿è¶Šæ™‚ç©º",text:"ç´…ç£šåœ“æ‹±éš§é“ï¼Œå½·å½¿ç½®èº«ã€Šç¥éš±å°‘å¥³ã€‹å ´æ™¯ã€‚"}],quote:"ã€Œç©¿è¶Šç™¾å¹´éš§é“ï¼Œèµ°é€²æ™‚å…‰çš„é€šé“ã€‚ã€"}},
    "spot10": { id:10, route:"R2", title:"è–å¾·å®®", img:"https://newtaipei.travel/content/images/attractions/26815/1024x768_attractions-image-w4q9s3h5g06342s3z9s-qa.jpg", desc:"å¤§å°–å±±è…°å®®å»Ÿï¼Œè¦–é‡æ¥µä½³çš„ä¼‘æ†©é»ã€‚", query:"æ±æ­¢è–å¾·å®®", hasBeacon:false, quizQ:"Q: è–å¾·å®®ä¸»è¦ä¾›å¥‰ï¼Ÿ", quizA:1, quizOpts:["A. é—œè–å¸å›","B. åª½ç¥–","C. åœŸåœ°å…¬"], story:{ sections:[{title:"å±±ä¸­è–æ®¿",text:"è–å¾·å®®ä½æ–¼å¤§å°–å±±åŠå±±è…°ï¼Œæ˜¯ç™»å±±é€”ä¸­é‡è¦ä¼‘æ†©ç«™ã€‚"}],quote:"ã€Œç™»é«˜æœ›é ï¼Œå¿ƒéˆèˆ‡è¦–é‡çš„é›™é‡é¥—å®´ã€‚ã€"}},
    "spot11": { id:11, route:"R2", title:"å¤§å°–å±±å¤©ç§€å®®", img:"https://newtaipei.travel/content/images/attractions/26815/1024x768_attractions-image-w4q9s3h5g06342s3z9s-qa.jpg", desc:"ä¿¯ç°å¤§å°åŒ—ç›†åœ°ï¼Œå¤•é™½å¤œæ™¯è¿·äººã€‚", query:"æ±æ­¢å¤©ç§€å®®", hasBeacon:true, quizQ:"Q: å¤©ç§€å®®æœ€è‘—åçš„æ™¯è§€æ˜¯ï¼Ÿ", quizA:3, quizOpts:["A. ç€‘å¸ƒ","B. å¤æ¨¹","C. ä¿¯ç°å¤§å°åŒ—ç›†åœ°"], story:{ sections:[{title:"çµ•ç¾è¦–é‡",text:"å¤©ç§€å®®å¯ä¿¯ç°æ•´å€‹å¤§å°åŒ—ç›†åœ°ï¼Œç”šè‡³å¯ä»¥çœ‹åˆ°101å¤§æ¨“ã€‚"}],quote:"ã€Œç«™åœ¨å¤©ç§€å®®ï¼Œæ•´å€‹å°åŒ—ç›¡æ”¶çœ¼åº•ã€‚ã€"}},
    "spot12": { id:12, route:"R2", title:"å¤§å°–å±±ç™»å±±æ­¥é“", img:"https://newtaipei.travel/content/images/attractions/26815/1024x768_attractions-image-w4q9s3h5g06342s3z9s-qa.jpg", desc:"çŸ³éšå®Œå–„ï¼Œæ—è”­èŒ‚å¯†ï¼Œå››å­£çš†å®œã€‚", query:"å¤§å°–å±±ç™»å±±æ­¥é“", hasBeacon:false, quizQ:"Q: å¤§å°–å±±çš„æµ·æ‹”ç´„å¤šå°‘å…¬å°ºï¼Ÿ", quizA:2, quizOpts:["A. 260 å…¬å°º","B. 460 å…¬å°º","C. 660 å…¬å°º"], story:{ sections:[{title:"æ±æ­¢äººçš„å¾ŒèŠ±åœ’",text:"å¤§å°–å±±æµ·æ‹”ç´„460å…¬å°ºï¼Œæ˜¯æ±æ­¢æœ€çŸ¥åçš„éƒŠå±±ã€‚"}],quote:"ã€Œå¤§å°–å±±ï¼Œæ˜¯æ±æ­¢äººé‹å‹•å¥èº«çš„æœ€ä½³å»è™•ã€‚ã€"}},
    "spot13": { id:13, route:"R2", title:"ç§€å³°ç€‘å¸ƒ", img:"https://newtaipei.travel/content/images/attractions/26815/1024x768_attractions-image-w4q9s3h5g06342s3z9s-qa.jpg", desc:"å³½è°·æ¸…å¹½ç€‘å¸ƒï¼Œè² é›¢å­æ¸…æ¶¼ç§˜å¢ƒã€‚", query:"æ±æ­¢ç§€å³°ç€‘å¸ƒ", hasBeacon:true, quizQ:"Q: ç§€å³°ç€‘å¸ƒä»¥ä»€éº¼èåï¼Ÿ", quizA:2, quizOpts:["A. æº«æ³‰","B. è² é›¢å­","C. è¢ç«èŸ²"], story:{ sections:[{title:"æ¸…æ¶¼ç§˜å¢ƒ",text:"ç§€å³°ç€‘å¸ƒé«˜ç´„15å…¬å°ºï¼Œæ°´æµé£›æ¿ºï¼Œç”¢ç”Ÿå¤§é‡è² é›¢å­ã€‚"}],quote:"ã€Œç§€å³°ç€‘å¸ƒï¼Œæ˜¯æ±æ­¢æœ€æ¸…æ¶¼çš„é¿æš‘å‹åœ°ã€‚ã€"}},
    "spot14": { id:14, route:"R2", title:"å››åˆ†å°¾å±±", img:"https://newtaipei.travel/content/images/attractions/26815/1024x768_attractions-image-w4q9s3h5g06342s3z9s-qa.jpg", desc:"å°ç™¾å²³ï¼Œä¸€ç­‰ä¸‰è§’é»ï¼Œ360åº¦è¦–é‡ã€‚", query:"æ±æ­¢å››åˆ†å°¾å±±", hasBeacon:false, quizQ:"Q: å››åˆ†å°¾å±±æœ‰ä»€éº¼ç‰¹æ®Šæ¨™è¨˜ï¼Ÿ", quizA:1, quizOpts:["A. ä¸€ç­‰ä¸‰è§’é»","B. å¤è¹Ÿç¢‘","C. è§€æ™¯å°"], story:{ sections:[{title:"å°ç™¾å²³ä¹‹ä¸€",text:"å››åˆ†å°¾å±±æµ·æ‹”641å…¬å°ºï¼Œæ˜¯å°ç£å°ç™¾å²³ä¹‹ä¸€ã€‚"}],quote:"ã€Œç™»ä¸Šå››åˆ†å°¾å±±ï¼Œå±±æµ·ç¾æ™¯ç›¡æ”¶çœ¼åº•ã€‚ã€"}},
    "spot15": { id:15, route:"R3", title:"æ±ç§‘ç«è»Šç«™åŒ—ç«™", img:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5a/TRA_Xike_Station_20131002.jpg/800px-TRA_Xike_Station_20131002.jpg", desc:"ç¨ç‰¹é•·å‹æœˆå°è¨­è¨ˆï¼Œè»Œé“æ”å½±å–æ™¯åœ°ã€‚", query:"æ±ç§‘ç«è»Šç«™", hasBeacon:false, quizQ:"Q: æ±ç§‘ç«™æœ‰ä»€éº¼ç‰¹åˆ¥ä¹‹è™•ï¼Ÿ", quizA:2, quizOpts:["A. æœ€å¤è€è»Šç«™","B. ç‰¹é•·æœˆå°è¨­è¨ˆ","C. æµ·æ™¯è»Šç«™"], story:{ sections:[{title:"ç¨ç‰¹è¨­è¨ˆ",text:"æ±ç§‘ç«™æ˜¯å…¨å°æœ€é•·çš„ç«è»Šç«™ï¼Œæœˆå°é•·åº¦è¶…é900å…¬å°ºã€‚"}],quote:"ã€Œæ±ç§‘ç«™ï¼Œä¸€åº§æ‰“ç ´å¸¸è¦çš„è»Šç«™ã€‚ã€"}},
    "spot16": { id:16, route:"R3", title:"æ‹±åŒ—æ®¿", img:"https://newtaipei.travel/content/images/attractions/26786/1024x768_attractions-image-j1o3r4gbu06342s3z9s-qa.jpg", desc:"è³æ¥“å‹åœ°ï¼Œã€Œå½¼å²¸æ©‹ã€æ—¥å¼å¤å‰é¢¨æƒ…ã€‚", query:"æ±æ­¢æ‹±åŒ—æ®¿", hasBeacon:true, quizQ:"Q: æ‹±åŒ—æ®¿æœ€è‘—åçš„æ˜¯ä»€éº¼ï¼Ÿ", quizA:2, quizOpts:["A. æ«»èŠ±","B. æ¥“è‘‰èˆ‡å½¼å²¸æ©‹","C. ç€‘å¸ƒ"], story:{ sections:[{title:"å½äº¬éƒ½ç§˜å¢ƒ",text:"æ‹±åŒ—æ®¿å»ºæ–¼1906å¹´ï¼Œç§‹å¤©æ¥“ç´…æ™‚ç¯€ç¾å¾—å¦‚è©©å¦‚ç•«ã€‚"}],quote:"ã€Œæ‹±åŒ—æ®¿çš„æ¥“ç´…ï¼Œæ˜¯ç§‹å¤©æœ€ç¾çš„é‚‚é€…ã€‚ã€"}},
    "spot17": { id:17, route:"R3", title:"æ–°å±±å¤¢æ¹–", img:"https://newtaipei.travel/content/images/attractions/26815/1024x768_attractions-image-w4q9s3h5g06342s3z9s-qa.jpg", desc:"å¤¢å¹»ç¢§ç¶ æ¹–æ³Šï¼Œå©šç´—æ‹æ”è–åœ°ã€‚", query:"æ–°å±±å¤¢æ¹–", hasBeacon:true, quizQ:"Q: æ–°å±±å¤¢æ¹–ä»¥ä»€éº¼èåï¼Ÿ", quizA:1, quizOpts:["A. å©šç´—æ‹æ”è–åœ°","B. æº«æ³‰","C. å¤è¹Ÿ"], story:{ sections:[{title:"å¤¢å¹»æ¹–æ³Š",text:"å¤¢æ¹–æ¹–æ°´ç¢§ç¶ å¦‚ç¿¡ç¿ ï¼Œæ¸…æ™¨å¸¸æœ‰é›²éœ§ç¹šç¹ã€‚"}],quote:"ã€Œå¤¢æ¹–ï¼Œæ˜¯æ±æ­¢é€çµ¦æˆ€äººæœ€ç¾çš„ç¦®ç‰©ã€‚ã€"}},
    "spot18": { id:18, route:"R3", title:"å¤§é‡‘å‰›å²©", img:"https://newtaipei.travel/content/images/attractions/26815/1024x768_attractions-image-w4q9s3h5g06342s3z9s-qa.jpg", desc:"å½¢ç‹€é…·ä¼¼é‡‘å‰›é ­éƒ¨çš„å·¨å²©å¥‡æ™¯ã€‚", query:"æ–°å±±å¤§é‡‘å‰›å²©", hasBeacon:false, quizQ:"Q: å¤§é‡‘å‰›å²©çš„åç¨±ç”±ä¾†ï¼Ÿ", quizA:3, quizOpts:["A. ç™¼ç¾è€…å§“å","B. åœ°å","C. å½¢ç‹€åƒé‡‘å‰›"], story:{ sections:[{title:"å·¨å²©å¥‡æ™¯",text:"å¾ç‰¹å®šè§’åº¦çœ‹ï¼Œå½¢ç‹€é…·ä¼¼é‡‘å‰›çš„é ­éƒ¨ã€‚"}],quote:"ã€Œç«™åœ¨å¤§é‡‘å‰›å²©ä¸Šï¼Œæœ‰ç¨®å¾æœä¸–ç•Œçš„æ„Ÿè¦ºã€‚ã€"}},
    "spot19": { id:19, route:"R3", title:"æ–°å±±", img:"https://newtaipei.travel/content/images/attractions/26815/1024x768_attractions-image-w4q9s3h5g06342s3z9s-qa.jpg", desc:"æµ·æ‹”499å…¬å°ºï¼Œä¿¯ç°å¤¢æ¹–å…¨æ™¯ã€‚", query:"æ±æ­¢æ–°å±±", hasBeacon:false, quizQ:"Q: æ–°å±±çš„æµ·æ‹”ç´„å¤šå°‘å…¬å°ºï¼Ÿ", quizA:2, quizOpts:["A. 299 å…¬å°º","B. 499 å…¬å°º","C. 699 å…¬å°º"], story:{ sections:[{title:"é‡è¶£ç™»å±±",text:"æ–°å±±å±±é ‚æ˜¯ä¸€å¤§ç‰‡è£¸éœ²å²©çŸ³ï¼Œè¦–é‡æ¥µä½³ã€‚"}],quote:"ã€Œæ–°å±±çš„è’é‡ä¹‹ç¾ï¼Œæ˜¯ç™»å±±è€…æœ€æ„›çš„çå‹µã€‚ã€"}},
    "spot20": { id:20, route:"R4", title:"ç§€å³°å±±éœä¿®ç¦ªé™¢", img:"https://newtaipei.travel/content/images/attractions/26786/1024x768_attractions-image-j1o3r4gbu06342s3z9s-qa.jpg", desc:"å¹½éœç¦ªé™¢ï¼Œæ—¥æ²»æ™‚æœŸå‰µå»ºã€‚", query:"æ±æ­¢éœä¿®ç¦ªé™¢", hasBeacon:false, quizQ:"Q: éœä¿®ç¦ªé™¢ä½æ–¼å“ªåº§å±±ï¼Ÿ", quizA:1, quizOpts:["A. ç§€å³°å±±","B. å¤§å°–å±±","C. å››åˆ†å°¾å±±"], story:{ sections:[{title:"å¿ƒéˆæ·¨åœŸ",text:"éœä¿®ç¦ªé™¢å‰µå»ºæ–¼æ—¥æ²»æ™‚æœŸï¼Œç’°å¢ƒæ¸…å¹½ã€‚"}],quote:"ã€Œåœ¨å–§å›‚çš„åŸå¸‚ä¸­ï¼Œéœä¿®ç¦ªé™¢æ˜¯ä¸€æ–¹æ·¨åœŸã€‚ã€"}},
    "spot21": { id:21, route:"R4", title:"æœæœˆç¬™å¢“åœ’", img:"https://newtaipei.travel/content/images/attractions/26815/1024x768_attractions-image-w4q9s3h5g06342s3z9s-qa.jpg", desc:"ä¸Šæµ·ç˜å‚³å¥‡äººç‰©é•·çœ ä¹‹åœ°ã€‚", query:"æœæœˆç¬™å¢“åœ’", hasBeacon:true, quizQ:"Q: æœæœˆç¬™æ˜¯å“ªè£¡çš„å‚³å¥‡äººç‰©ï¼Ÿ", quizA:3, quizOpts:["A. å°åŒ—","B. é¦™æ¸¯","C. ä¸Šæµ·"], story:{ sections:[{title:"å‚³å¥‡äººç‰©",text:"æœæœˆç¬™ï¼ˆ1888-1951ï¼‰æ˜¯æ°‘åœ‹æ™‚æœŸä¸Šæµ·ç˜æœ€å…·å‚³å¥‡è‰²å½©çš„äººç‰©ã€‚"}],quote:"ã€Œä¸€ä»£æ¢Ÿé›„ï¼Œé•·çœ æ–¼æ­¤ã€‚ã€"}},
    "spot22": { id:22, route:"R4", title:"ç§€å³°å±±å½Œå‹’å…§é™¢", img:"https://newtaipei.travel/content/images/attractions/26815/1024x768_attractions-image-w4q9s3h5g06342s3z9s-qa.jpg", desc:"ä¾›å¥‰å½Œå‹’ä½›ï¼ŒåŒ—éƒ¨ä½›æ•™è–åœ°ã€‚", query:"æ±æ­¢å½Œå‹’å…§é™¢", hasBeacon:false, quizQ:"Q: å½Œå‹’å…§é™¢ä¸»è¦ä¾›å¥‰ï¼Ÿ", quizA:2, quizOpts:["A. è§€éŸ³è©è–©","B. å½Œå‹’ä½›","C. åœ°è—ç‹è©è–©"], story:{ sections:[{title:"å½Œå‹’é“å ´",text:"å½Œå‹’å…§é™¢æ˜¯åŒ—å°ç£é‡è¦çš„ä½›æ•™è–åœ°ã€‚"}],quote:"ã€Œå½Œå‹’å…§é™¢ï¼Œæ˜¯ä¿¡ä»°è€…çš„å¿ƒéˆæ­¸ä¾ã€‚ã€"}},
    "spot23": { id:23, route:"R4", title:"å¿ é †å»Ÿ", img:"https://newtaipei.travel/content/images/attractions/26786/1024x768_attractions-image-j1o3r4gbu06342s3z9s-qa.jpg", desc:"åŸæ±æ­¢ç¥ç¤¾ï¼Œä¿ç•™é³¥å±…çŸ³ç‡ˆç± ã€‚", query:"æ±æ­¢å¿ é †å»Ÿ", hasBeacon:true, quizQ:"Q: å¿ é †å»ŸåŸæœ¬æ˜¯ä»€éº¼å»ºç¯‰ï¼Ÿ", quizA:2, quizOpts:["A. åª½ç¥–å»Ÿ","B. æ—¥æœ¬ç¥ç¤¾","C. å­”å»Ÿ"], story:{ sections:[{title:"ç¥ç¤¾éºè·¡",text:"å¿ é †å»Ÿçš„åŸå€æ˜¯æ—¥æ²»æ™‚æœŸçš„ã€Œæ±æ­¢ç¥ç¤¾ã€ï¼Œå»ºæ–¼1937å¹´ã€‚"}],quote:"ã€Œå¿ é †å»Ÿï¼Œè¦‹è­‰äº†æ±æ­¢å¾æ—¥æ²»åˆ°æˆ°å¾Œçš„æ­·å²è®Šé·ã€‚ã€"}}
};

var eventsData = {
    "E01": { id:"E01", title:"å¤¢æƒ³ç¤¾å€å˜‰å¹´è¯", date:"2026/12/15", location:"æ±æ­¢å¤¢æƒ³ç¤¾å€", query:"æ±æ­¢å¤¢æƒ³ç¤¾å€", img:"https://images.unsplash.com/photo-1533174072545-7a4b6ad7a6c3?w=800", desc:"å…¨å°æœ€ç˜‹ç‹‚çš„è—è¡“éŠè¡Œã€‚", tags:["ğŸ­ è—è¡“éŠè¡Œ","ğŸ¥ æ£®å·´é¼“"], gallery:[{img:"https://images.unsplash.com/photo-1514525253161-7a46d19cd819?w=600",caption:"<strong>æ£®å·´é¼“éšŠç†±æƒ…æ¼”å‡º</strong>"}], notices:["æ´»å‹•ç•¶å¤©é“è·¯ç®¡åˆ¶","è«‹è‡ªå‚™ç’°ä¿é¤å…·"] },
    "E02": { id:"E02", title:"åº·èª¥æºªæ«»èŠ±å­£", date:"2026/02/15", location:"æ±æ­¢åº·èª¥æºªç•”", query:"æ±æ­¢åº·èª¥æºª", img:"https://images.unsplash.com/photo-1522383225653-ed111181a951?w=800", desc:"æ±æ­¢äººçš„è³æ«»ç§˜å¢ƒï¼", tags:["ğŸŒ¸ å±±æ«»èŠ±","ğŸŒ™ å¤œé–“é»ç‡ˆ"], gallery:[{img:"https://images.unsplash.com/photo-1490750967868-88aa4486c946?w=600",caption:"<strong>ç²‰ç´…èŠ±æµ·ç››é–‹</strong>"}], notices:["èŠ±æœŸç´„2-3é€±","è«‹å‹¿æ”€æŠ˜èŠ±æœ¨"] },
    "E03": { id:"E03", title:"æ±ç¢‡è·¯è¢ç«èŸ²", date:"2026/04/15", location:"æ±æ­¢æ±ç¢‡è·¯", query:"æ±æ­¢æ±ç¢‡è·¯ è¢ç«èŸ²", img:"https://images.unsplash.com/photo-1507400492013-162706c8c05e?w=800", desc:"å¤¢å¹»å¤œé–“å°æ—…è¡Œï¼", tags:["âœ¨ è¢ç«èŸ²","ğŸŒ™ å¤œé–“å°è¦½"], gallery:[{img:"https://images.unsplash.com/photo-1528818955841-a7f1425c3e36?w=600",caption:"<strong>è¢å…‰é»é»</strong>"}], notices:["è«‹ç©¿è‘—é•·è¢–é•·è¤²","ç¦æ­¢ä½¿ç”¨é–ƒå…‰ç‡ˆ"] }
};

var currentData = null, isEventPage = false, storyExpanded = false;

window.onload = function() {
    liff.init({ liffId: MY_LIFF_ID }).then(function() { renderContent(); }).catch(function(err) { console.error(err); renderContent(); });
};

function renderContent() {
    try {
        var urlParams = new URLSearchParams(window.location.search);
        var pageId = urlParams.get('id') || 'spot1';
        if (pageId.indexOf('E') === 0 && eventsData[pageId]) { isEventPage = true; renderEventPage(pageId); }
        else { isEventPage = false; renderSpotPage(pageId); }
    } catch (e) { document.getElementById('loading').innerHTML = 'è¼‰å…¥å¤±æ•—'; }
}

function renderEventPage(eventId) {
    var data = eventsData[eventId]; currentData = data;
    document.getElementById('beacon-banner').style.display = 'none';
    document.getElementById('game-section').style.display = 'none';
    document.getElementById('food-section').style.display = 'none';
    document.getElementById('survey-box').style.display = 'none';
    document.getElementById('memorial-box').style.display = 'none';
    document.getElementById('reset-link').style.display = 'none';
    document.getElementById('bus-schedule-link').style.display = 'none';
    document.getElementById('desc-actions').style.display = 'none';
    document.getElementById('wish-btn').style.display = 'none';
    document.querySelector('.progress-container').style.display = 'none';
    document.getElementById('tags-container').style.display = 'flex';
    document.getElementById('gallery-section').style.display = 'block';
    document.getElementById('notice-box').style.display = 'block';
    document.getElementById('spot-img').src = data.img;
    document.getElementById('route-tag').innerHTML = 'ğŸª é™å®šæ´»å‹•';
    document.getElementById('route-tag').style.background = '#ff6b6b';
    document.getElementById('route-desc').innerHTML = 'ğŸ“… ' + data.date + ' ï½œ ğŸ“ ' + data.location;
    document.getElementById('spot-number').style.display = 'none';
    document.getElementById('spot-title').innerText = data.title;
    document.getElementById('spot-desc').innerText = data.desc;
    var tagsHtml = ''; for (var i = 0; i < data.tags.length; i++) { tagsHtml += '<span class="tag">' + data.tags[i] + '</span>'; }
    document.getElementById('tags-container').innerHTML = tagsHtml;
    var galleryHtml = ''; for (var j = 0; j < data.gallery.length; j++) { galleryHtml += '<div class="gallery-item"><img src="' + data.gallery[j].img + '" class="gallery-img"><div class="gallery-caption">' + data.gallery[j].caption + '</div></div>'; }
    document.getElementById('gallery-content').innerHTML = galleryHtml;
    var noticeHtml = ''; for (var k = 0; k < data.notices.length; k++) { noticeHtml += '<li>' + data.notices[k] + '</li>'; }
    document.getElementById('notice-list').innerHTML = noticeHtml;
    var mapQuery = encodeURIComponent(data.query);
    document.getElementById('bus-btn').href = 'https://www.google.com/maps/search/?api=1&query=' + mapQuery;
    document.getElementById('bus-label').innerText = 'å°èˆªå‰å¾€';
    document.getElementById('parking-btn').href = 'https://www.google.com/maps/search/?api=1&query=' + mapQuery + '+åœè»Šå ´';
    document.getElementById('map-btn').href = 'https://www.google.com/maps/search/?api=1&query=' + mapQuery;
    document.getElementById('loading').style.display = 'none';
    document.getElementById('main-content').style.display = 'block';
}

function renderSpotPage(spotKey) {
    var data = spotsData[spotKey]; if (!data) { data = spotsData['spot1']; spotKey = 'spot1'; }
    currentData = data; currentData.spotKey = spotKey;
    document.getElementById('game-section').style.display = 'block';
    document.getElementById('food-section').style.display = 'block';
    document.getElementById('bus-schedule-link').style.display = 'block';
    document.getElementById('desc-actions').style.display = 'flex';
    document.getElementById('wish-btn').style.display = 'block';
    document.getElementById('reset-link').style.display = 'block';
    document.querySelector('.progress-container').style.display = 'block';
    document.getElementById('tags-container').style.display = 'none';
    document.getElementById('gallery-section').style.display = 'none';
    document.getElementById('notice-box').style.display = 'none';
    document.getElementById('spot-img').src = data.img;
    document.getElementById('spot-title').innerText = data.title;
    document.getElementById('spot-desc').innerText = data.desc;
    var routeKey = data.route || "R1"; var rInfo = routesInfo[routeKey];
    if (rInfo) {
        document.getElementById('route-tag').innerText = rInfo.title;
        document.getElementById('route-desc').innerText = rInfo.desc;
        var spotIndex = rInfo.spots.indexOf(spotKey);
        if (spotIndex >= 0) { document.getElementById('spot-number').innerText = "ç¬¬ " + (spotIndex + 1) + " ç«™ï¼Œå…± " + rInfo.spots.length + " ç«™"; }
    }
    if (data.quizQ) {
        document.getElementById('quiz-question').innerText = data.quizQ;
        if (data.quizOpts) { document.getElementById('quiz-opt-1').innerText = data.quizOpts[0]; document.getElementById('quiz-opt-2').innerText = data.quizOpts[1]; document.getElementById('quiz-opt-3').innerText = data.quizOpts[2]; }
    }
    var mapQuery = encodeURIComponent(data.query);
    document.getElementById('map-btn').href = 'https://www.google.com/maps/search/?api=1&query=' + mapQuery;
    document.getElementById('parking-btn').href = 'https://www.google.com/maps/search/?api=1&query=' + mapQuery + '+åœè»Šå ´';
    document.getElementById('more-food-link').href = 'https://www.google.com/maps/search/?api=1&query=' + mapQuery + '+ç¾é£Ÿ';
    if (rInfo && rInfo.spots) {
        var currentIdx = rInfo.spots.indexOf(spotKey); var nextIdx = (currentIdx + 1) % rInfo.spots.length; var nextSpotKey = rInfo.spots[nextIdx]; var nextData = spotsData[nextSpotKey];
        if (nextData) { document.getElementById('bus-btn').href = 'https://www.google.com/maps/dir/?api=1&destination=' + encodeURIComponent(nextData.query) + '&travelmode=transit'; document.getElementById('bus-label').innerText = 'å»' + nextData.title; }
    }
    // æ¸²æŸ“ç¾é£Ÿå€å¡Š
    renderFoodSection(spotKey);
    if (data.hasBeacon) { setTimeout(function() { document.getElementById('beacon-banner').classList.add('show'); setTimeout(function() { document.getElementById('beacon-banner').classList.remove('show'); }, 8000); }, 3000); }
    initTaskProgress();
    document.getElementById('loading').style.display = 'none';
    document.getElementById('main-content').style.display = 'block';
}

function renderFoodSection(spotKey) {
    var foods = foodsData[spotKey] || foodsData['default'];
    var html = '';
    for (var i = 0; i < foods.length; i++) {
        var f = foods[i];
        html += '<div class="food-card" onclick="openFoodMap(\'' + f.query + '\')">';
        html += '<img src="' + f.img + '" class="food-img" onerror="this.src=\'https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=300\'">';
        html += '<div class="food-info">';
        html += '<div class="food-type">' + f.type + '</div>';
        html += '<div class="food-name">' + f.name + '</div>';
        html += '<div class="food-desc">' + f.desc + '</div>';
        html += '</div></div>';
    }
    document.getElementById('food-scroll').innerHTML = html;
}

function openFoodMap(query) {
    window.open('https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(query), '_blank');
}

function toggleStory() {
    var detail = document.getElementById('story-detail'); var btn = document.getElementById('read-more-btn');
    if (!storyExpanded && currentData && currentData.story) {
        var html = '';
        for (var i = 0; i < currentData.story.sections.length; i++) {
            var sec = currentData.story.sections[i];
            html += '<div class="story-section"><div class="story-title">' + sec.title + '</div><p class="story-text">' + sec.text + '</p>';
            if (sec.img) { html += '<img src="' + sec.img + '" class="story-img"><p class="story-caption">' + (sec.caption || '') + '</p>'; }
            html += '</div>';
        }
        if (currentData.story.quote) { html += '<div class="story-quote">' + currentData.story.quote + '</div>'; }
        detail.innerHTML = html; detail.classList.add('show'); btn.innerText = 'â–² æ”¶èµ·æ•…äº‹'; storyExpanded = true;
    } else { detail.classList.remove('show'); btn.innerText = 'â–¼ äº†è§£æ›´å¤šæ•…äº‹'; storyExpanded = false; }
}

function collectAction(taskName) { var c = JSON.parse(localStorage.getItem('xizhi_stamps')) || []; if (c.indexOf(taskName) === -1) { c.push(taskName); localStorage.setItem('xizhi_stamps', JSON.stringify(c)); setTimeout(initTaskProgress, 500); } }
function handleClickWithTrack(taskName) { collectAction(taskName); }
function isTaskDone(taskName) { var c = JSON.parse(localStorage.getItem('xizhi_stamps')) || []; return c.indexOf(taskName) !== -1; }
function initTaskProgress() {
    var c = JSON.parse(localStorage.getItem('xizhi_stamps')) || []; var icons = { 'map': 'ğŸ—ºï¸', 'quiz': 'â“', 'wish': 'â¤ï¸', 'beacon': 'ğŸ“¡', 'share': 'ğŸ“¤' };
    for (var i = 0; i < TASKS.length; i++) { var t = TASKS[i]; var el = document.getElementById('stamp-' + t); if (el) { if (c.indexOf(t) !== -1) { el.classList.add('active'); el.innerText = 'âœ“'; } else { el.classList.remove('active'); el.innerText = icons[t]; } } }
    var wishBtn = document.getElementById('wish-btn'); if (c.indexOf('wish') !== -1) { wishBtn.classList.add('active'); wishBtn.innerHTML = 'â¤ï¸'; }
    document.getElementById('progress-text').innerText = c.length + '/5'; document.getElementById('progress-bar').style.width = (c.length / 5) * 100 + '%';
    if (c.length >= 5) { document.getElementById('survey-box').style.display = 'block'; document.getElementById('memorial-box').style.display = 'block'; }
}
function handleBeaconClick() { document.getElementById('beacon-banner').classList.remove('show'); alert("ğŸ‰ ç²å¾—ã€å°‹å¯¶å°ç« ã€‘"); collectAction('beacon'); }
function openQuizModal() { if (isTaskDone('quiz')) { alert("å·²å®Œæˆï¼"); return; } document.getElementById('quiz-modal').style.display = 'flex'; }
function checkQuiz(answerIdx) { var correct = currentData ? currentData.quizA : 2; if (answerIdx === correct) { document.getElementById('quiz-modal').style.display = 'none'; alert("â­• ç­”å°äº†ï¼ç²å¾—ã€å•ç­”å°ç« ã€‘"); collectAction('quiz'); } else { alert("âŒ ç­”éŒ¯äº†ï¼Œå†è©¦è©¦ï¼"); } }
function triggerWishlist() { var btn = document.getElementById('wish-btn'); if (btn.classList.contains('active')) { btn.classList.remove('active'); btn.innerHTML = 'â™¡'; } else { btn.classList.add('active'); btn.innerHTML = 'â¤ï¸'; if (!isTaskDone('wish')) { alert("ç²å¾—ã€æƒ³å»å°ç« ã€‘"); collectAction('wish'); } } }

// æ–°å¢ï¼šæ‰“å¡åˆ†äº«åŠŸèƒ½ï¼ˆæ•´åˆå°ç« ï¼‰
function handleShareWithStamp() {
    document.getElementById('share-modal').style.display = 'flex';
}

function closeModal(id, e) { if (e.target.id === id || e.target.classList.contains('close-modal')) { document.getElementById(id).style.display = 'none'; } }
function shareTo(platform) { 
    var url = window.location.href; 
    var title = document.getElementById('spot-title').innerText; 
    var text = 'ğŸ“¸ æˆ‘æ­£åœ¨æ±æ­¢æ‰“å¡ï¼š' + title + 'ï¼å¿«ä¾†ä¸€èµ·æ¢ç´¢ï½'; 
    
    // åˆ†äº«å¾Œç²å¾—å°ç« 
    if (!isTaskDone('share')) {
        setTimeout(function() { alert("ğŸ“¸ åˆ†äº«æˆåŠŸï¼ç²å¾—ã€åˆ†äº«å°ç« ã€‘"); collectAction('share'); }, 500);
    }
    
    if (platform === 'line') { 
        window.location.href = 'https://line.me/R/msg/text/?' + encodeURIComponent(text + ' ' + url); 
    } else if (platform === 'fb') { 
        window.open('https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(url) + '&quote=' + encodeURIComponent(text)); 
    } else if (platform === 'ig') {
        if (navigator.clipboard) { navigator.clipboard.writeText(text + ' ' + url).then(function() { alert("å·²è¤‡è£½æ–‡å­—ï¼è«‹æ‰“é–‹ Instagram è²¼ä¸Šåˆ†äº«"); }); }
    } else if (platform === 'copy') { 
        if (navigator.clipboard) { navigator.clipboard.writeText(url).then(function() { alert("é€£çµå·²è¤‡è£½ï¼"); }); } 
    } 
    document.getElementById('share-modal').style.display = 'none'; 
}

// é•·æŒ‰3ç§’è§¸ç™¼é‡ç½®æŒ‰éˆ•
var longPressTimer = null;

function initDevTrigger() {
    var devTrigger = document.getElementById('dev-trigger');
    if (!devTrigger) return;
    
    // è§¸æ§è£ç½®
    devTrigger.addEventListener('touchstart', function(e) {
        e.preventDefault();
        longPressTimer = setTimeout(function() {
            document.getElementById('reset-link').style.display = 'block';
            if (navigator.vibrate) navigator.vibrate(100);
            alert('ğŸ”§ é–‹ç™¼è€…æ¨¡å¼å·²å•Ÿç”¨');
        }, 3000);
    });
    
    devTrigger.addEventListener('touchend', function() { clearTimeout(longPressTimer); });
    devTrigger.addEventListener('touchmove', function() { clearTimeout(longPressTimer); });
    
    // æ»‘é¼ è£ç½®
    devTrigger.addEventListener('mousedown', function() {
        longPressTimer = setTimeout(function() {
            document.getElementById('reset-link').style.display = 'block';
            alert('ğŸ”§ é–‹ç™¼è€…æ¨¡å¼å·²å•Ÿç”¨');
        }, 3000);
    });
    
    devTrigger.addEventListener('mouseup', function() { clearTimeout(longPressTimer); });
    devTrigger.addEventListener('mouseleave', function() { clearTimeout(longPressTimer); });
}

function resetProgress() { 
    if (confirm("ç¢ºå®šè¦é‡ç½®æ‰€æœ‰é€²åº¦å—ï¼Ÿ\nï¼ˆåŒ…å«å°ç« å’Œç€è¦½ç´€éŒ„ï¼‰")) { 
        localStorage.removeItem('xizhi_stamps'); 
        localStorage.removeItem('xizhi_visited'); 
        location.reload(); 
    } 
}

// ç´€å¿µç…§ä¸Šå‚³èˆ‡ä¸‹è¼‰
function handleImageUpload(e) { 
    var file = e.target.files[0]; 
    if (!file) return; 
    var reader = new FileReader(); 
    reader.onload = function(event) { 
        var img = new Image(); 
        img.onload = function() { 
            var canvas = document.getElementById('result-canvas'); 
            var ctx = canvas.getContext('2d'); 
            canvas.width = 800; 
            canvas.height = 800; 
            
            // ç¹ªè£½èƒŒæ™¯æ¼¸å±¤
            var gradient = ctx.createLinearGradient(0, 0, 800, 800);
            gradient.addColorStop(0, '#667eea');
            gradient.addColorStop(1, '#764ba2');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 800, 800);
            
            // ç¹ªè£½ä½¿ç”¨è€…ç…§ç‰‡ï¼ˆåœ“å½¢è£åˆ‡ï¼‰
            var scale = Math.max(600 / img.width, 600 / img.height); 
            ctx.save();
            ctx.beginPath();
            ctx.arc(400, 350, 250, 0, Math.PI * 2);
            ctx.closePath();
            ctx.clip();
            ctx.drawImage(img, 400 - (img.width / 2) * scale, 350 - (img.height / 2) * scale, img.width * scale, img.height * scale); 
            ctx.restore();
            
            // ç¹ªè£½é‚Šæ¡†
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 8;
            ctx.beginPath();
            ctx.arc(400, 350, 254, 0, Math.PI * 2);
            ctx.stroke();
            
            // ç¹ªè£½æ–‡å­—
            ctx.fillStyle = '#fff';
            ctx.font = 'bold 36px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('ğŸ† æ±æ­¢é”äººèªè­‰ ğŸ†', 400, 680);
            
            ctx.font = '24px sans-serif';
            ctx.fillText('å®Œæˆæ‰€æœ‰æŒ‘æˆ°ï¼', 400, 730);
            
            ctx.font = '16px sans-serif';
            ctx.fillStyle = 'rgba(255,255,255,0.7)';
            var today = new Date();
            ctx.fillText(today.getFullYear() + '/' + (today.getMonth()+1) + '/' + today.getDate(), 400, 770);
            
            // é¡¯ç¤ºçµæœ
            document.getElementById('final-img').src = canvas.toDataURL("image/jpeg", 0.9); 
            document.getElementById('final-img').style.display = "block"; 
            document.getElementById('download-btn').style.display = "inline-block";
            document.getElementById('download-msg').style.display = "block"; 
        }; 
        img.src = event.target.result; 
    }; 
    reader.readAsDataURL(file); 
}

// ä¸‹è¼‰ç´€å¿µç…§åŠŸèƒ½
function downloadImage() {
    var canvas = document.getElementById('result-canvas');
    var link = document.createElement('a');
    link.download = 'æ±æ­¢é”äººç´€å¿µç…§_' + new Date().getTime() + '.jpg';
    link.href = canvas.toDataURL('image/jpeg', 0.9);
    link.click();
}
</script>
</body>
</html> + encodeURIComponent(text + ' ' + url); 
    } else if (platform === 'fb') { 
        window.open('https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(url) + '&quote=' + encodeURIComponent(text)); 
    } else if (platform === 'ig') {
        // IG ç„¡æ³•ç›´æ¥åˆ†äº«é€£çµï¼Œè¤‡è£½æ–‡å­—è®“ä½¿ç”¨è€…è²¼ä¸Š
        if (navigator.clipboard) { navigator.clipboard.writeText(text + ' ' + url).then(function() { alert("å·²è¤‡è£½æ–‡å­—ï¼è«‹æ‰“é–‹ Instagram è²¼ä¸Šåˆ†äº«"); }); }
    } else if (platform === 'copy') { 
        if (navigator.clipboard) { navigator.clipboard.writeText(url).then(function() { alert("é€£çµå·²è¤‡è£½ï¼"); }); } 
    } 
    document.getElementById('share-modal').style.display = 'none'; 
}

function resetProgress() { if (confirm("é‡ç½®é€²åº¦ï¼Ÿ")) { localStorage.removeItem('xizhi_stamps'); location.reload(); } }

// é•·æŒ‰3ç§’é¡¯ç¤ºé‡ç½®æŒ‰éˆ•
var longPressTimer = null;
var devTrigger = null;

function initDevTrigger() {
    devTrigger = document.getElementById('dev-trigger');
    if (!devTrigger) return;
    
    // è§¸æ§è£ç½®
    devTrigger.addEventListener('touchstart', function(e) {
        longPressTimer = setTimeout(function() {
            document.getElementById('reset-link').style.display = 'block';
            if (navigator.vibrate) navigator.vibrate(100); // éœ‡å‹•å›é¥‹
            alert('ğŸ”§ é–‹ç™¼è€…æ¨¡å¼å·²å•Ÿç”¨');
        }, 3000);
    });
    
    devTrigger.addEventListener('touchend', function() {
        clearTimeout(longPressTimer);
    });
    
    devTrigger.addEventListener('touchmove', function() {
        clearTimeout(longPressTimer);
    });
    
    // æ»‘é¼ è£ç½®
    devTrigger.addEventListener('mousedown', function() {
        longPressTimer = setTimeout(function() {
            document.getElementById('reset-link').style.display = 'block';
            alert('ğŸ”§ é–‹ç™¼è€…æ¨¡å¼å·²å•Ÿç”¨');
        }, 3000);
    });
    
    devTrigger.addEventListener('mouseup', function() {
        clearTimeout(longPressTimer);
    });
    
    devTrigger.addEventListener('mouseleave', function() {
        clearTimeout(longPressTimer);
    });
}

// é é¢è¼‰å…¥å¾Œåˆå§‹åŒ–
window.addEventListener('load', function() {
    setTimeout(initDevTrigger, 500);
});

function handleImageUpload(e) { var file = e.target.files[0]; if (!file) return; var reader = new FileReader(); reader.onload = function(event) { var img = new Image(); img.onload = function() { var canvas = document.getElementById('result-canvas'); var ctx = canvas.getContext('2d'); canvas.width = 800; canvas.height = 800; var scale = Math.max(800 / img.width, 800 / img.height); ctx.drawImage(img, 400 - (img.width / 2) * scale, 400 - (img.height / 2) * scale, img.width * scale, img.height * scale); document.getElementById('final-img').src = canvas.toDataURL("image/jpeg", 0.8); document.getElementById('final-img').style.display = "block"; document.getElementById('download-msg').style.display = "block"; }; img.src = event.target.result; }; reader.readAsDataURL(file); }
</script>
</body>
</html>
